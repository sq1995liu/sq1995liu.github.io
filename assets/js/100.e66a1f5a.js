(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{1089:function(s,a,t){"use strict";t.r(a);var n=t(21),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_01-nginx-keepalive方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_01-nginx-keepalive方案"}},[s._v("#")]),s._v(" 01.Nginx+KeepAlive方案")]),s._v(" "),n("h2",{attrs:{id:"_1-1-机器规划和架构图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-机器规划和架构图"}},[s._v("#")]),s._v(" 1.1 机器规划和架构图")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("角色")]),s._v(" "),n("th",[s._v("IP")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("nginx反向代理+"),n("code",[s._v("keepalive-master")])]),s._v(" "),n("td",[s._v("192.168.56.61")])]),s._v(" "),n("tr",[n("td",[s._v("web01")]),s._v(" "),n("td",[s._v("192.168.56.62")])]),s._v(" "),n("tr",[n("td",[s._v("web02")]),s._v(" "),n("td",[s._v("192.168.56.63")])]),s._v(" "),n("tr",[n("td",[s._v("nginx反向代理+"),n("code",[s._v("keepalive-slave")])]),s._v(" "),n("td",[s._v("192.168.56.64")])])])]),s._v(" "),n("p",[n("img",{staticStyle:{width:"600px","margin-left":"50px"},attrs:{src:t(339)}})]),s._v(" "),n("h2",{attrs:{id:"_1-2-部署nginx负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-部署nginx负载均衡"}},[s._v("#")]),s._v(" 1.2 部署nginx负载均衡")]),s._v(" "),n("ul",[n("li",[s._v("192.168.56.61（"),n("code",[s._v("keepalive-master")]),s._v("）")]),s._v(" "),n("li",[s._v("192.168.56.64（"),n("code",[s._v("keepalive-slave")]),s._v("）")])]),s._v(" "),n("h3",{attrs:{id:"_1-2-1-配置nginx负载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-配置nginx负载"}},[s._v("#")]),s._v(" 1.2.1 配置nginx负载")]),s._v(" "),n("ul",[n("li",[s._v("安装nginx服务")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node4 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# yum "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("配置反向代理")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\nstream "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log_format  main  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    access_log  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("django"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    upstream django"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".62")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   \n    server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       proxy_pass django"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h3",{attrs:{id:"_1-2-2-完整配置如下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-完整配置如下"}},[s._v("#")]),s._v(" 1.2.2 完整配置如下")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("看一下即可，都是nginx默认配置")])])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \nuser  nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nworker_processes  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nerror_log  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log warn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\npid        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    worker_connections  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nstream "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log_format  main  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    access_log  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("django"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    upstream django"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".62")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   \n    server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       proxy_pass django"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    include       "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    default_type  application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("octet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    log_format  main  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    access_log  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    sendfile        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    #tcp_nopush     on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    keepalive_timeout  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    #gzip  on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    include "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*.conf;\n}\n")])])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("h3",{attrs:{id:"_1-2-3-测试反向代理可用性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-测试反向代理可用性"}},[s._v("#")]),s._v(" 1.2.3 测试反向代理可用性")]),s._v(" "),n("ul",[n("li",[s._v("测试集群可用性")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("http"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".62")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("        # web01\nhttp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("        # web02\n# 可以停止一个nginx服务，测试可用性\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("服务管理")])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slave "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl start nginx\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slave "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl enable nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"_2-3-keepalive安装与配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-keepalive安装与配置"}},[s._v("#")]),s._v(" 2.3 keepalive安装与配置")]),s._v(" "),n("h3",{attrs:{id:"_2-3-1-安装keepalive"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-安装keepalive"}},[s._v("#")]),s._v(" 2.3.1 安装keepalive")]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# yum "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install keepalived\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_2-3-2-keepalive-master配置修改"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-keepalive-master配置修改"}},[s._v("#")]),s._v(" 2.3.2 keepalive-master配置修改")]),s._v(" "),n("ul",[n("li",[s._v("==注：默认的keepalived.conf配置太多，直接删除，用下面配置替换即可==")]),s._v(" "),n("li",[n("code",[s._v("192.168.56.61")])])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \n\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n   notification_email "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n     acassen@firewall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc \n     failover@firewall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc \n     sysadmin@firewall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc \n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n   notification_email_from Alexandre"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Cassen@firewall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc  \n   smtp_server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" \n   smtp_connect_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" \n   router_id "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NGINX_MASTER")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n\n# 健康监测nginx\nvrrp_script check_nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    script "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/keepalived/check_nginx.sh"')]),s._v("      # 设置检查nginx是否存活的脚本位置\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n# keepalive热备组配置\nvrrp_instance "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VI_1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    state "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MASTER")]),s._v("            # 配置当前keepalive为master角色\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("eth0")]),s._v("           # 网卡名字，必须和实际网卡名称一致，默认是ens33\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("       # "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VRRP")]),s._v(" 路由 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ID")]),s._v("实例，每个实例是唯一的 \n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("            # 优先级，备服务器设置 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v(" \n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            # 指定"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VRRP")]),s._v(" 心跳包通告间隔时间，默认"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("秒 \n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        auth_type "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PASS")]),s._v("      \n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("       # 设置keepalive的master和slave之间简单的秘钥认证\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".60")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("     # 设置keepalive虚拟"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("地址\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n    track_script "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        check_nginx\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("h3",{attrs:{id:"_2-3-3-keepalive-slave配置修改"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-keepalive-slave配置修改"}},[s._v("#")]),s._v(" 2.3.3 keepalive-slave配置修改")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("==注：默认的keepalived.conf配置太多，直接删除，用下面配置替换即可==")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("192.168.56.64")])])])]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \n \nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n   notification_email "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n     acassen@firewall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc \n     failover@firewall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc \n     sysadmin@firewall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc \n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n   notification_email_from Alexandre"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Cassen@firewall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc  \n   smtp_server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" \n   smtp_connect_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" \n   router_id "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NGINX_BACKUP")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n\nvrrp_script check_nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    script "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/keepalived/check_nginx.sh"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VI_1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    state "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BACKUP")]),s._v("            # 设置keepalive角色为backend\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("eth0")]),s._v("           # 设置虚拟网卡名称\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("       # "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VRRP")]),s._v(" 路由 "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ID")]),s._v("实例，每个实例是唯一的，master和slave保持一致即可\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("             # 优先级，备服务器设置 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v(" \n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            # 指定"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VRRP")]),s._v(" 心跳包通告间隔时间，默认"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("秒 \n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        auth_type "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PASS")]),s._v("      \n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".60")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("     # 设置虚拟网卡地址\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n    track_script "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        check_nginx\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("h3",{attrs:{id:"_2-3-4-添加nginx健康监测脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4-添加nginx健康监测脚本"}},[s._v("#")]),s._v(" 2.3.4 添加nginx健康监测脚本")]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master keepalived"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("check_nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n#"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bash\ncount"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ps "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ef "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("grep nginx "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("egrep "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cv "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grep|$$"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$count"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("eq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("then\n    exit "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n    exit "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nfi\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master keepalived"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# chmod "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("x "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("check_nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh         # 给脚本添加一个可执行权限\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"_2-3-5-启动keepalive"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-5-启动keepalive"}},[s._v("#")]),s._v(" 2.3.5 启动keepalive")]),s._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  systemctl start keepalived\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  systemctl enable keepalived\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"_2-4-测试keepalive高可用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-测试keepalive高可用"}},[s._v("#")]),s._v(" 2.4 测试keepalive高可用")]),s._v(" "),n("ul",[n("li",[s._v("测试使用 http://192.168.56.60:88/ 虚拟IP访问\n"),n("ul",[n("li",[s._v("在浏览器中访问: http://192.168.56.60   http://192.168.56.61   http://192.168.56.64  都可以访问web1和web2服务")])])]),s._v(" "),n("li",[s._v("关闭lb-master（192.168.56.61）的nginx测试VIP是否漂移到备节点\n"),n("ul",[n("li",[s._v("在192.168.56.61中停止nginx服务（lb-master）,lb-slave中可以接替master的服务")]),s._v(" "),n("li",[s._v("依然可以使用 http://192.168.56.60:88/ 访问web01和web02服务")])])])]),s._v(" "),n("p",[n("img",{staticStyle:{width:"700px","margin-left":"50px"},attrs:{src:t(740)}})])])}),[],!1,null,null,null);a.default=e.exports},339:function(s,a,t){s.exports=t.p+"assets/img/image-20210114124305020.ceeeb97d.png"},740:function(s,a,t){s.exports=t.p+"assets/img/image-20210114121631136.83b9e85e.png"}}]);