(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{1002:function(s,t,a){"use strict";a.r(t);var r=a(21),n=Object(r.a)({},(function(){var s=this,t=s.$createElement,r=s._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h1",{attrs:{id:"_01-ingress是什么"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_01-ingress是什么"}},[s._v("#")]),s._v(" 01.Ingress是什么")]),s._v(" "),r("h2",{attrs:{id:"_1-1-nodeport存在不足"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-nodeport存在不足"}},[s._v("#")]),s._v(" 1.1 NodePort存在不足")]),s._v(" "),r("p",[r("code",[s._v("NodePort对外暴露端口存在的不足")]),s._v("：")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("一个端口只能一个服务使用，端口需提前规划")])]),s._v(" "),r("li",[r("p",[s._v("只支持4层负载均衡")])])]),s._v(" "),r("h2",{attrs:{id:"_1-2-ingress-最佳对外暴露端口方案"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-ingress-最佳对外暴露端口方案"}},[s._v("#")]),s._v(" 1.2 Ingress(最佳对外暴露端口方案)")]),s._v(" "),r("ul",[r("li",[r("strong",[r("code",[s._v("Ingress：")])]),s._v(" "),r("ul",[r("li",[s._v("Ingress是K8s中的一个抽象资源，给管理员提供一个暴露应用的入口定义方法")]),s._v(" "),r("li",[s._v("Ingress公开了从集群外部到集群内服务的HTTP和HTTPS路由的规则集合")])])]),s._v(" "),r("li",[r("strong",[r("code",[s._v("Ingress Controller")]),s._v("：")]),s._v(" "),r("ul",[r("li",[s._v("Ingress Controller根据Ingress生成具体的路由规则，并对Pod负载均衡器")]),s._v(" "),r("li",[s._v("Ingress Controller实质作用就是"),r("code",[s._v("根据域名进行转发")])])])])]),s._v(" "),r("p",[r("img",{staticStyle:{width:"700px","margin-left":"50px"},attrs:{src:a(671)}})]),s._v(" "),r("h2",{attrs:{id:"_1-3-ingress-contronler怎么工作的？"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-ingress-contronler怎么工作的？"}},[s._v("#")]),s._v(" 1.3 Ingress Contronler怎么工作的？")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("Ingress Contronler通过与 Kubernetes API 交互，动态的去感知集群中 Ingress 规则变化，然后读取它")])]),s._v(" "),r("li",[r("p",[s._v("按照自定义的规则，规则就是写明了哪个域名对应哪个service，生成一段 Nginx 配置，应用到管理的Nginx服务，然后热加载生效。")])]),s._v(" "),r("li",[r("p",[s._v("以此来达到Nginx负载均衡器配置及动态更新的问题。")])]),s._v(" "),r("li",[r("p",[r("strong",[s._v("流程包流程：客户端 ->Ingress Controller（nginx） -> 分布在各节点Pod")])])])]),s._v(" "),r("h1",{attrs:{id:"_02-安装ingress-controller（k8s-master安装）"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_02-安装ingress-controller（k8s-master安装）"}},[s._v("#")]),s._v(" 02.安装Ingress Controller（k8s-master安装）")]),s._v(" "),r("ul",[r("li",[s._v("这里使用 ingress-nginx 作为控制器\n"),r("ul",[r("li",[s._v("除了ingress-nginx还有很多控制器："),r("a",{attrs:{href:"https://haproxy-ingress.github.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("HAProxy Ingress"),r("OutboundLink")],1),s._v("等")]),s._v(" "),r("li",[s._v("其他控制器：https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/")])])]),s._v(" "),r("li",[r("strong",[s._v("部署文件注意事项：（修改两个地方）")]),s._v(" "),r("ul",[r("li",[s._v("（第一处）镜像地址修改成国内的：lizhenliang/nginx-ingress-controller:0.30.0")]),s._v(" "),r("li",[s._v("（第二处）将Ingress Controller暴露，一般使用宿主机网络（hostNetwork: true）或者使用NodePort")]),s._v(" "),r("li",[r("img",{staticStyle:{width:"1000px","margin-left":"0px"},attrs:{src:a(672)}})])])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# wget https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("raw"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.30")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("deploy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mandatory"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cp mandatory"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml   # 重命名方便理解文件\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vi mandatory"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml   # 修改下面这两个地方\nhostNetwork"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("                # 第一处，在containers同级上添加"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hostNetwork: true"')]),s._v("\ncontainers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller\n    # image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" quay"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.30")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\n    image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" lizhenliang"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.30")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("   # 第二处，注释原有国外镜像，修改成国内的个人镜像  \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br")])]),r("ul",[r("li",[r("code",[s._v("部署Ingress Controller")]),s._v(" : 部署完成可以看到宿主机监听了 80和 443端口")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml  \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("svc "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nginx "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o wide\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                              "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NOMINATED")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READINESS")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GATES")]),s._v("\npod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("dc64b58f"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fljtd   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("m   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".62")]),s._v("   k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("h1",{attrs:{id:"_03-使用ingress部署应用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_03-使用ingress部署应用"}},[s._v("#")]),s._v(" 03.使用Ingress部署应用")]),s._v(" "),r("h2",{attrs:{id:"_3-1-部署service"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-部署service"}},[s._v("#")]),s._v(" 3.1 部署Service")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"400px","margin-left":"50px"},attrs:{src:a(673)}})]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  vim app"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" apps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Deployment\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" web1\n  namespace"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  replicas"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  selector"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    matchLabels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" web1\n  template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    metadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      labels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" web1\n    spec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      containers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" web\n        image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.18")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Service\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" web1\n  namespace"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  ports"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("        # Service端口\n    protocol"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("    # 协议\n    targetPort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("   # 容器端口（程序启动端口，比如django默认是"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("端口）\n  selector"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" \n    app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx      # 指定关联Pod的标签（上面已经查到了，app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx）\n  type"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ClusterIP      # 服务类型\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f app"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("svc\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br"),r("span",{staticClass:"line-number"},[s._v("36")]),r("br")])]),r("h2",{attrs:{id:"_3-2-使用ingress部署应用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-使用ingress部署应用"}},[s._v("#")]),s._v(" 3.2 使用Ingress部署应用")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("web1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" networking"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Ingress\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" web1\nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  rules"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" host"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" web1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\n    http"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      paths"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" path"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n        pathType"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Prefix\n        backend"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" web1\n            port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n              number"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("web1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" ingress            # 查看创建的资源\nWarning"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" extensions"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1beta1 Ingress is deprecated "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" unavailable "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" use networking"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1 Ingress\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLASS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOSTS")]),s._v("              "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ADDRESS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\nweb1   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   web1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com             "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("m\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br")])]),r("h2",{attrs:{id:"_3-3-配置域名记录"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-配置域名记录"}},[s._v("#")]),s._v(" 3.3 配置域名记录")]),s._v(" "),r("ul",[r("li",[s._v("修改 C:\\Windows\\System32\\drivers\\etc\\hosts 记录")]),s._v(" "),r("li",[s._v("添加： 192.168.56.62  web1.example.com")]),s._v(" "),r("li",[s._v("因为刚刚创建的 Ingress被部署到了 192.168.56.62  机器中，所以这里使用域名解析也必须是他")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("svc "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nginx "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o wide\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                              "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NOMINATED")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READINESS")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GATES")]),s._v("\npod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("dc64b58f"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fljtd   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("m   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".62")]),s._v("   k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("h1",{attrs:{id:"_04-ingress-controller高可用方案"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_04-ingress-controller高可用方案"}},[s._v("#")]),s._v(" 04.Ingress Controller高可用方案")]),s._v(" "),r("ul",[r("li",[s._v("上面部署方案很明显，Ingress Controller只部署到了其中一台节点上，这样是单点故障")])]),s._v(" "),r("h2",{attrs:{id:"_4-1-daemonset重新部署ingress-controller"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-daemonset重新部署ingress-controller"}},[s._v("#")]),s._v(" 4.1 DaemonSet重新部署Ingress Controller")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" deploy nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nginx   # 删除ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nginx服务\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml    # 修改配置\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 将 kind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Deployment 修改成 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("》 kind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" DaemonSet\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）删除 replicas"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 这行配置\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml  \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("ul",[r("li",[s._v("可以看到 k8s集群中所有节点都部署了 ingress-controller（所有节点这样就都可以访问服务了）")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("svc "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nginx "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o wide\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                       "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("              "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NOMINATED")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READINESS")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GATES")]),s._v("\npod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f9wvw   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("m   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".62")]),s._v("   k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\npod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("wpf6w   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("m   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),s._v("   k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("h2",{attrs:{id:"_4-2-企业中部署ingress方案"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-企业中部署ingress方案"}},[s._v("#")]),s._v(" 4.2 企业中部署Ingress方案")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("上面DaemonSet在所有k8s节点都部署了 Ingress Controller，但是真实环境肯k8s集群太大，容易浪费资源")])]),s._v(" "),r("li",[r("p",[s._v("所以，一般Ingress Controller会以==DaemonSet+nodeSelector=="),r("code",[s._v("部署到几台特定的node节点中")])])]),s._v(" "),r("li",[r("p",[s._v("然后将这几台挂载到公网负载均衡器对外提供服务")])])]),s._v(" "),r("p",[r("img",{staticStyle:{width:"400px","margin-left":"50px"},attrs:{src:a(674)}})])])}),[],!1,null,null,null);t.default=n.exports},671:function(s,t,a){s.exports=a.p+"assets/img/image-20210129095358555.eb61e4de.png"},672:function(s,t,a){s.exports=a.p+"assets/img/image-20210129103643098.dd37bd03.png"},673:function(s,t,a){s.exports=a.p+"assets/img/image-20210129122626393.0f9fb86e.png"},674:function(s,t,a){s.exports=a.p+"assets/img/image-20210129132532067.ad95a305.png"}}]);