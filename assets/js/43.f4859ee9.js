(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{336:function(s,t,a){s.exports=a.p+"assets/img/image-20201216095605860.76482c53.png"},631:function(s,t,a){s.exports=a.p+"assets/img/image-20201220222924054.34615e50.png"},632:function(s,t,a){s.exports=a.p+"assets/img/image-20201220232617992.23efdea3.png"},989:function(s,t,a){"use strict";a.r(t);var r=a(21),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,r=s._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h1",{attrs:{id:"_01-多k8s-master架构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_01-多k8s-master架构"}},[s._v("#")]),s._v(" 01.多k8s-master架构")]),s._v(" "),r("table",[r("thead",[r("tr",[r("th",[s._v("角色")]),s._v(" "),r("th",[s._v("IP")]),s._v(" "),r("th",[s._v("组件")])])]),s._v(" "),r("tbody",[r("tr",[r("td",[r("code",[s._v("k8s-master1")])]),s._v(" "),r("td",[s._v("192.168.56.63")]),s._v(" "),r("td",[s._v("kube-apiserver"),r("br"),s._v("kube-controller-manager"),r("br"),s._v("kube-scheduler"),r("br"),s._v("etcd")])]),s._v(" "),r("tr",[r("td",[r("code",[s._v("k8s-master2")])]),s._v(" "),r("td",[s._v("192.168.56.64")]),s._v(" "),r("td",[s._v("kube-apiserver"),r("br"),s._v("kube-controller-manager"),r("br"),s._v("kube-scheduler")])]),s._v(" "),r("tr",[r("td",[r("code",[s._v("k8s-node1")])]),s._v(" "),r("td",[s._v("192.168.56.65")]),s._v(" "),r("td",[s._v("kubelet"),r("br"),s._v("kube-proxy"),r("br"),s._v("docker"),r("br"),s._v("etcd")])]),s._v(" "),r("tr",[r("td",[r("code",[s._v("k8s-node2")])]),s._v(" "),r("td",[s._v("192.168.56.66")]),s._v(" "),r("td",[s._v("kubelet"),r("br"),s._v("kube-proxy"),r("br"),s._v("docker"),r("br"),s._v("etcd")])]),s._v(" "),r("tr",[r("td",[r("code",[s._v("Load Balancer(Master)")])]),s._v(" "),r("td",[s._v("192.168.31.61"),r("br"),s._v("==192.168.56.60（VIP）==")]),s._v(" "),r("td",[s._v("Nginx L4")])]),s._v(" "),r("tr",[r("td",[r("code",[s._v("Load Balancer(Backup)")])]),s._v(" "),r("td",[s._v("192.168.31.62")]),s._v(" "),r("td",[s._v("Nginx L4")])])])]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px","margin-left":"20px"},attrs:{src:a(336)}})]),s._v(" "),r("h1",{attrs:{id:"_02-k8s-master2配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_02-k8s-master2配置"}},[s._v("#")]),s._v(" 02.k8s-master2配置")]),s._v(" "),r("h2",{attrs:{id:"_2-1-在k8s-master1拷贝-opt-配置文件到k8s-master2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-在k8s-master1拷贝-opt-配置文件到k8s-master2"}},[s._v("#")]),s._v(" 2.1 在k8s-master1拷贝/opt/配置文件到k8s-master2")]),s._v(" "),r("p",[s._v("==k8s-master1和k8s-maser2配置基本一致，直接拷贝过去即可==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.讲k8s-master1中的配置文件和证书拷贝到master2   '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# scp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" root@"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".64")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token regex"}},[r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("opt")]),r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.由于k8s-master2也要连接etcd所以要讲k8s-master1证书拷贝过去'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 opt"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# scp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" root@"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".64")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd    \n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.把管理服务的 .service 文件拷贝过去 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 opt"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# scp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("systemd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service root@"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".64")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("systemd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4.将kubectl命令拷贝到k8s-master2中 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 opt"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# scp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubectl root@"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".64")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubectl \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("h2",{attrs:{id:"_2-2-在k8s-master2中仅需要修改kube-apiserver-conf地址"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-在k8s-master2中仅需要修改kube-apiserver-conf地址"}},[s._v("#")]),s._v(" 2.2 在k8s-master2中仅需要修改kube-apiserver.conf地址")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master2 opt"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("KUBE_APISERVER_OPTS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v('"'),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("logtostderr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("v"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("servers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".65")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("bind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".64")]),s._v(" \\           # 绑定地址修改成 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".64")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("secure"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("advertise"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".64")]),s._v(" \\        # 通告地址修改成 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".64")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("allow"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("privileged"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ip"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("range"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("enable"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admission"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugins"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NamespaceLifecycle"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("LimitRanger"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ServiceAccount"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ResourceQuota"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("NodeRestriction \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("mode"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RBAC")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Node \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("enable"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bootstrap"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("token"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("token"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csv \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("range"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30000")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("32767")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certificate"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("tls"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem  \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("tls"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("account"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cafile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certfile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keyfile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("audit"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("maxage"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("audit"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("maxbackup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("audit"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("maxsize"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("audit"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("path"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("audit"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v('log"\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br")])]),r("h2",{attrs:{id:"_2-3-启动服务并设置开机自启动"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-启动服务并设置开机自启动"}},[s._v("#")]),s._v(" 2.3 启动服务并设置开机自启动")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.启动服务 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\nsystemctl start kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver\nsystemctl start kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager\nsystemctl start kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.设置服务开机自启动 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\nsystemctl enable kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver\nsystemctl enable kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager\nsystemctl enable kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.查看服务启动状态  '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 opt"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tail "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*    # 可以看日志\nsystemctl status kube-apiserver\nsystemctl status kube-controller-manager\nsystemctl stauts kube-scheduler\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])]),r("ul",[r("li",[s._v("确定k8s-master2服务正常")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 opt"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" node\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLES")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VERSION")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1   Ready    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("d4h   v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.0")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2   Ready    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("d3h   v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.0")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("h1",{attrs:{id:"_03-部署nginx负载均衡"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_03-部署nginx负载均衡"}},[s._v("#")]),s._v(" 03.部署Nginx负载均衡")]),s._v(" "),r("h2",{attrs:{id:"_3-1-安装nginx"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-安装nginx"}},[s._v("#")]),s._v(" 3.1 安装nginx")]),s._v(" "),r("h3",{attrs:{id:"_3-1-1-获取niginx-rpm包"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-获取niginx-rpm包"}},[s._v("#")]),s._v(" 3.1.1 获取niginx rpm包")]),s._v(" "),r("ul",[r("li",[s._v("nginx rpm包地址：http://nginx.org/packages/rhel/7/x86_64/RPMS/")])]),s._v(" "),r("p",[r("img",{staticStyle:{width:"600px","margin-left":"20px"},attrs:{src:a(631)}})]),s._v(" "),r("ul",[r("li",[s._v("在"),r("code",[s._v("192.168.56.61")]),s._v("和"),r("code",[s._v("192.168.56.62")]),s._v("中安装nginx")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slave "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# rpm "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ivh http"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("org"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("packages"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rhel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("x86_64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RPMS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.16")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("el7"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ngx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x86_64"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rpm\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h3",{attrs:{id:"_3-1-2-修改nginx-conf配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-修改nginx-conf配置文件"}},[s._v("#")]),s._v(" 3.1.2 修改nginx.conf配置文件")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf   # 添加一个stream配置即可\nstream "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log_format  main  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    access_log  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("access"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    upstream k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                server "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                server "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".64")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   \n    server "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       listen "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       proxy_pass k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br")])]),r("ul",[r("li",[s._v("完整配置如下(看一下即可，都是nginx默认配置)")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \nuser  nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nworker_processes  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nerror_log  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log warn"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\npid        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nevents "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    worker_connections  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nstream "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log_format  main  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    access_log  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("access"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    upstream k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                server "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                server "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".64")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n    server "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       listen "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       proxy_pass k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nhttp "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    include       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mime"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("types"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    default_type  application"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("octet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stream"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    log_format  main  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n                      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n                      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    access_log  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("access"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    sendfile        on"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    #tcp_nopush     on"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    keepalive_timeout  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    #gzip  on"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    include "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*.conf;\n}\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br")])]),r("h3",{attrs:{id:"_3-3-3-启动nginx"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-启动nginx"}},[s._v("#")]),s._v(" 3.3.3 启动nginx")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slave "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl start nginx\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slave "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl enable nginx\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h1",{attrs:{id:"_04-keepalive高可用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_04-keepalive高可用"}},[s._v("#")]),s._v(" 04.keepalive高可用")]),s._v(" "),r("h2",{attrs:{id:"_4-1-keepalive安装与配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-keepalive安装与配置"}},[s._v("#")]),s._v(" 4.1 keepalive安装与配置")]),s._v(" "),r("h3",{attrs:{id:"_4-1-安装keepalive"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-安装keepalive"}},[s._v("#")]),s._v(" 4.1 安装keepalive")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# yum "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install keepalived\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h3",{attrs:{id:"_4-2-keepalive-master配置修改"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-keepalive-master配置修改"}},[s._v("#")]),s._v(" 4.2 keepalive-master配置修改")]),s._v(" "),r("ul",[r("li",[s._v("==注：默认的keepalived.conf配置太多，直接删除，用下面配置替换即可==")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \n\nglobal_defs "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n   notification_email "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n     acassen@firewall"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc \n     failover@firewall"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc \n     sysadmin@firewall"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc \n   "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n   notification_email_from Alexandre"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Cassen@firewall"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc  \n   smtp_server "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" \n   smtp_connect_timeout "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" \n   router_id "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NGINX_MASTER")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n\n# 健康监测nginx\nvrrp_script check_nginx "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    script "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/keepalived/check_nginx.sh"')]),s._v("      # 设置检查nginx是否存活的脚本位置\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n# keepalive热备组配置\nvrrp_instance "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VI_1")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    state "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MASTER")]),s._v("            # 配置当前keepalive为master角色\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("eth0")]),s._v("           # 网卡名字，必须和实际网卡名称一致，默认是ens33\n    virtual_router_id "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("       # "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VRRP")]),s._v(" 路由 "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ID")]),s._v("实例，每个实例是唯一的 \n    priority "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("            # 优先级，备服务器设置 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v(" \n    advert_int "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            # 指定"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VRRP")]),s._v(" 心跳包通告间隔时间，默认"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("秒 \n    authentication "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        auth_type "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PASS")]),s._v("      \n        auth_pass "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("       # 设置keepalive的master和slave之间简单的秘钥认证\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n    virtual_ipaddress "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".60")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("     # 设置keepalive虚拟"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("地址\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n    track_script "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        check_nginx\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br"),r("span",{staticClass:"line-number"},[s._v("36")]),r("br"),r("span",{staticClass:"line-number"},[s._v("37")]),r("br")])]),r("h3",{attrs:{id:"_4-3-keepalive-slave配置修改"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-keepalive-slave配置修改"}},[s._v("#")]),s._v(" 4.3 keepalive-slave配置修改")]),s._v(" "),r("p",[s._v("==注：默认的keepalived.conf配置太多，直接删除，用下面配置替换即可==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \n \nglobal_defs "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n   notification_email "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n     acassen@firewall"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc \n     failover@firewall"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc \n     sysadmin@firewall"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc \n   "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n   notification_email_from Alexandre"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Cassen@firewall"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loc  \n   smtp_server "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" \n   smtp_connect_timeout "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" \n   router_id "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NGINX_BACKUP")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n\nvrrp_script check_nginx "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    script "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/keepalived/check_nginx.sh"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VI_1")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    state "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BACKUP")]),s._v("            # 设置keepalive角色为backend\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("eth0")]),s._v("           # 设置虚拟网卡名称\n    virtual_router_id "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("       # "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VRRP")]),s._v(" 路由 "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ID")]),s._v("实例，每个实例是唯一的，master和slave保持一致即可\n    priority "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("             # 优先级，备服务器设置 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v(" \n    advert_int "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            # 指定"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VRRP")]),s._v(" 心跳包通告间隔时间，默认"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("秒 \n    authentication "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        auth_type "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PASS")]),s._v("      \n        auth_pass "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v(" \n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n    virtual_ipaddress "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".60")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("     # 设置虚拟网卡地址\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n    track_script "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        check_nginx\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br")])]),r("h3",{attrs:{id:"_4-4-添加nginx健康监测脚本"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-添加nginx健康监测脚本"}},[s._v("#")]),s._v(" 4.4 添加nginx健康监测脚本")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master keepalived"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("keepalived"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("check_nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n#"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bash\ncount"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ps "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ef "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("grep nginx "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("egrep "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cv "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grep|$$"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$count"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("eq "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("then\n    exit "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n    exit "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nfi\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master keepalived"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# chmod "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("x check_nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh           # 给脚本添加一个可执行权限\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("h3",{attrs:{id:"_4-5-启动keepalive"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-启动keepalive"}},[s._v("#")]),s._v(" 4.5 启动keepalive")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  systemctl start keepalived\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  systemctl enable keepalived\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h2",{attrs:{id:"_4-2-测试keepalive高可用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-测试keepalive高可用"}},[s._v("#")]),s._v(" 4.2 测试keepalive高可用")]),s._v(" "),r("h3",{attrs:{id:"_4-2-1-在lb-master上可以看到已经绑定了虚拟ip"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-在lb-master上可以看到已经绑定了虚拟ip"}},[s._v("#")]),s._v(" 4.2.1 在lb-master上可以看到已经绑定了虚拟ip")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("在浏览器中访问: 192.168.56.60   192.168.56.61   192.168.56.61  都可以访问nginx默认页")])]),s._v(" "),r("li",[r("p",[s._v("关闭lb-master的nginx测试VIP是否漂移到备节点")])])]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px","margin-left":"20px"},attrs:{src:a(632)}})]),s._v(" "),r("h1",{attrs:{id:"_05-修改node连接vip"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_05-修改node连接vip"}},[s._v("#")]),s._v(" 05.修改Node连接VIP")]),s._v(" "),r("h2",{attrs:{id:"_5-1-测试vip是否正常工作"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-测试vip是否正常工作"}},[s._v("#")]),s._v(" 5.1 测试VIP是否正常工作")]),s._v(" "),r("p",[s._v("==理论讲在任意k8s-master节点和 k8s-node节点都可以通过VIP访问k8s-apiserver服务==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 logs"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# curl "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("header "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Authorization: Bearer c47ffb939f5ca36231d9e3121a252940"')]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".60")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("version\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"major"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"minor"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"16"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gitVersion"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1.16.0"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gitCommit"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2bd9643cee5b3b3a5ecbd3af49d09018f0773c77"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gitTreeState"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clean"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"buildDate"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2019-09-18T14:27:17Z"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"goVersion"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.12.9"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"compiler"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gc"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"platform"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux/amd64"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br")])]),r("h2",{attrs:{id:"_5-2-将所有k8s-node节点修改成vip"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-将所有k8s-node节点修改成vip"}},[s._v("#")]),s._v(" 5.2 将所有k8s-node节点修改成VIP")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.查看哪些配置文件配置了 192.168.56.63 作为apiserver  '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# grep "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\nbootstrap"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("     server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("\nkubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("      server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("    server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.批量修改  '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# sed "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#192.168.56.63#192.168.56.60#g'")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.确认是否修改成功 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# grep "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\nbootstrap"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("    server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".60")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("\nkubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("    server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".60")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("    server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".60")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])]),r("h2",{attrs:{id:"_5-3-检查集群是否正常"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-检查集群是否正常"}},[s._v("#")]),s._v(" 5.3 检查集群是否正常")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.在 lb-master上打开日志 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master keepalived"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tail "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("access"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log \n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.在所有node节点重启组件，可以在k8s-access.log日志中看到请求，每个组件重启都会重新访问kube-apiserver '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl restart kubelet\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl restart kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.无论是在 k8s-master1还是 k8s-master2都可以检查到，节点状态时正常的 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master2 opt"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" node\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLES")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VERSION")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1   Ready    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("d6h   v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.0")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2   Ready    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("d5h   v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.0")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);