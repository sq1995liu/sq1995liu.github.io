(window.webpackJsonp=window.webpackJsonp||[]).push([[212],{845:function(s,t,a){"use strict";a.r(t);var e=a(21),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_1-celery配置与基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-celery配置与基本使用"}},[s._v("#")]),s._v(" 1.celery配置与基本使用")]),s._v(" "),a("h3",{attrs:{id:"_1-1-安装celery"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-安装celery"}},[s._v("#")]),s._v(" 1.1 安装celery")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("pip install celery"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_1-2-新建celery-main-py配置celery"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-新建celery-main-py配置celery"}},[s._v("#")]),s._v(" 1.2 新建"),a("code",[s._v("celery/main.py")]),s._v("配置celery")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# celery_task/main.py")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" os\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" celery "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Celery\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义celery实例, 需要的参数, 1, 实例名, 2, 任务发布位置, 3, 结果保存位置")]),s._v("\napp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Celery"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mycelery'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n             broker"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis://127.0.0.1:6379/14'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 任务存放的地方 ")]),s._v("\n             backend"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'redis://127.0.0.1:6379/15'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 结果存放的地方")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @app.task 指定将这个函数的执行交给celery异步执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("task")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" y\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h1",{attrs:{id:"_2-测试celery"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-测试celery"}},[s._v("#")]),s._v(" 2.测试celery")]),s._v(" "),a("h3",{attrs:{id:"_2-1-启动celery"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-启动celery"}},[s._v("#")]),s._v(" 2.1 启动celery")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v("'''1.启动celery'''")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.1 单进程启动celery")]),s._v("\ncelery "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("A main worker "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l INFO\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.2 celery管理")]),s._v("\ncelery  multi start celery_test "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("A celery_test "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l debug "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("autoscale"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# celery并发数：最多50个，最少5个")]),s._v("\nps auxww"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("grep "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"celery worker"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("grep "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v grep"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("awk "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("xargs kill "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭所有celery进程")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);