(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{576:function(s,t,a){s.exports=a.p+"assets/img/image-20210223212139361.653f6364.png"},577:function(s,t,a){s.exports=a.p+"assets/img/image-20210223212337922.1ec3453a.png"},928:function(s,t,a){"use strict";a.r(t);var e=a(21),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"_01-配置集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_01-配置集群"}},[s._v("#")]),s._v(" 01.配置集群")]),s._v(" "),e("ul",[e("li",[s._v("VMware版本号：16.0.0")])]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("Master/Slave")]),s._v(" "),e("th",[s._v("系统")]),s._v(" "),e("th",[s._v("IP")]),s._v(" "),e("th",[s._v("Redis版本")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("Master")]),s._v(" "),e("td",[s._v("CentOS 7.5")]),s._v(" "),e("td",[s._v("192.168.56.65")]),s._v(" "),e("td",[s._v("redis-5.0.3")])]),s._v(" "),e("tr",[e("td",[s._v("Slave")]),s._v(" "),e("td",[s._v("CentOS 7.5")]),s._v(" "),e("td",[s._v("192.168.56.66")]),s._v(" "),e("td",[s._v("redis-5.0.3")])])])]),s._v(" "),e("h3",{attrs:{id:"_1-1-安装redis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-安装redis"}},[s._v("#")]),s._v(" 1.1 安装redis")]),s._v(" "),e("ul",[e("li",[s._v("在master和slave中分别安装好redis-server")]),s._v(" "),e("li",[e("a",{attrs:{href:"http://v5blog.cn/pages/4d3a23/",target:"_blank",rel:"noopener noreferrer"}},[s._v("安装redis"),e("OutboundLink")],1)])]),s._v(" "),e("h3",{attrs:{id:"_1-2-master配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-master配置"}},[s._v("#")]),s._v(" 1.2 Master配置")]),s._v(" "),e("ul",[e("li",[s._v("Master都是基本的配置，但要将 "),e("strong",[s._v("bind 127.0.0.1")]),s._v(" 改为 "),e("strong",[s._v("bind 0.0.0.0")]),s._v(" ，要不然Slave会连不上")]),s._v(" "),e("li",[s._v("日志提示“Error condition on socket for SYNC: Connection refused”。")])]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),e("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /usr/local/redis/bin/redis.conf")]),s._v("\nbind "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"_1-3-slave配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-slave配置"}},[s._v("#")]),s._v(" 1.3 Slave配置")]),s._v(" "),e("ul",[e("li",[s._v("Slave除基本的配置外，需要增加 "),e("strong",[s._v("slaveof 10.10.3.211 6379")])]),s._v(" "),e("li",[s._v("如果有密码就配置 masterauth")])]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),e("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /usr/local/redis/bin/redis.conf")]),s._v("\nbind "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".65")]),s._v("\nslaveof "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"_1-4-查看主从信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-查看主从信息"}},[s._v("#")]),s._v(" 1.4 查看主从信息")]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),e("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart redis")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),e("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis -h 192.168.56.66 info Replication")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Replication")]),s._v("\nrole"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("master\nconnected_slaves"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nslave0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ip"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v(".65")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("state"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("online"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("offset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("lag"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里可以看到redis从服务器信息")]),s._v("\nmaster_replid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("650401390e63f086e4dff957b896a4598895ba57")]),s._v("\nmaster_replid2"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0000000000000000000000000000000000000000")]),s._v("\nmaster_repl_offset"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("\nsecond_repl_offset"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nrepl_backlog_active"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nrepl_backlog_size"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1048576")]),s._v("\nrepl_backlog_first_byte_offset"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nrepl_backlog_histlen"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h3",{attrs:{id:"_1-5-测试是否自动同步"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-测试是否自动同步"}},[s._v("#")]),s._v(" 1.5 测试是否自动同步")]),s._v(" "),e("p",[e("img",{staticStyle:{width:"800px","margin-left":"20px"},attrs:{src:a(576)}})]),s._v(" "),e("h2",{attrs:{id:"_02-主从概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_02-主从概念"}},[s._v("#")]),s._v(" 02.主从概念")]),s._v(" "),e("h3",{attrs:{id:"_2-1-redis主从概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-redis主从概念"}},[s._v("#")]),s._v(" 2.1 redis主从概念")]),s._v(" "),e("ul",[e("li",[s._v("⼀个master可以拥有多个slave，⼀个slave⼜可以拥有多个slave，如此下去，形成了强⼤的多级服务器集群架构")]),s._v(" "),e("li",[s._v("master用来写数据，slave用来读数据，经统计：网站的读写比率是10:1")]),s._v(" "),e("li",[s._v("通过主从配置可以实现读写分离")])]),s._v(" "),e("p",[e("img",{staticStyle:{width:"400px","margin-left":"20px"},attrs:{src:a(577)}})]),s._v(" "),e("h3",{attrs:{id:"_2-2-redis主从弊端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-redis主从弊端"}},[s._v("#")]),s._v(" 2.2 redis主从弊端")]),s._v(" "),e("ul",[e("li",[s._v("缺点：主节点宕机，无法继续使用")]),s._v(" "),e("li",[s._v("因为只有master可以进行写入")])])])}),[],!1,null,null,null);t.default=n.exports}}]);