(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{335:function(s,t,a){s.exports=a.p+"assets/img/image-20201216095338593.9a97f4ab.png"},633:function(s,t,a){s.exports=a.p+"assets/img/image-20201218184612485.3ef32d2e.png"},634:function(s,t,a){s.exports=a.p+"assets/img/image-20201217121128868.409fe482.png"},635:function(s,t,a){s.exports=a.p+"assets/img/image-20201217121717190.fb2c48fe.png"},636:function(s,t,a){s.exports=a.p+"assets/img/image-20201217122249241.fb376f83.png"},637:function(s,t,a){s.exports=a.p+"assets/img/image-20201218114158616.c2830789.png"},638:function(s,t,a){s.exports=a.p+"assets/img/image-20201218192537657.b0352c15.png"},639:function(s,t,a){s.exports=a.p+"assets/img/image-20201219122259629.3faab0d9.png"},990:function(s,t,a){"use strict";a.r(t);var r=a(21),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,r=s._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h1",{attrs:{id:"_01-k8s单master集群结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_01-k8s单master集群结构"}},[s._v("#")]),s._v(" 01.k8s单master集群结构")]),s._v(" "),r("h2",{attrs:{id:"_1-1-单k8s-master架构图"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-单k8s-master架构图"}},[s._v("#")]),s._v(" 1.1 单k8s-master架构图")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px","margin-left":"20px"},attrs:{src:a(335)}})]),s._v(" "),r("h2",{attrs:{id:"_1-2-k8s各组件ip规划"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-k8s各组件ip规划"}},[s._v("#")]),s._v(" 1.2 k8s各组件ip规划")]),s._v(" "),r("table",[r("thead",[r("tr",[r("th",[s._v("角色")]),s._v(" "),r("th",[s._v("IP")]),s._v(" "),r("th",[s._v("组件")])])]),s._v(" "),r("tbody",[r("tr",[r("td",[r("code",[s._v("k8s-master1")])]),s._v(" "),r("td",[s._v("192.168.56.63")]),s._v(" "),r("td",[s._v("kube-apiserver"),r("br"),s._v("kube-controller-manager"),r("br"),s._v("kube-scheduler"),r("br"),r("code",[s._v("etcd")])])]),s._v(" "),r("tr",[r("td",[r("code",[s._v("k8s-node1")])]),s._v(" "),r("td",[s._v("192.168.56.65")]),s._v(" "),r("td",[s._v("kubelet"),r("br"),s._v("kube-proxy"),r("br"),s._v("docker"),r("br"),r("code",[s._v("etcd")])])]),s._v(" "),r("tr",[r("td",[r("code",[s._v("k8s-node2")])]),s._v(" "),r("td",[s._v("192.168.56.66")]),s._v(" "),r("td",[s._v("kubelet"),r("br"),s._v("kube-proxy"),r("br"),s._v("docker"),r("br"),r("code",[s._v("etcd")])])])])]),s._v(" "),r("h2",{attrs:{id:"_1-3-k8s与docker分层结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-k8s与docker分层结构"}},[s._v("#")]),s._v(" 1.3 k8s与docker分层结构")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"700px","margin-left":"20px"},attrs:{src:a(633)}})]),s._v(" "),r("h1",{attrs:{id:"_02-k8s-master1上签发证书"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_02-k8s-master1上签发证书"}},[s._v("#")]),s._v(" 02.k8s-master1上签发证书")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("为 etcd 三台机器的集群签发证书\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("为 kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver 签发证书\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("为 kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy 签发证书\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("h2",{attrs:{id:"_2-1-安装cfssl"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装cfssl"}},[s._v("#")]),s._v(" 2.1 安装cfssl")]),s._v(" "),r("ul",[r("li",[s._v("==将TLS.tar.gz的二进制文件拖到 /root文件夹下==")])]),s._v(" "),r("p",[r("code",[s._v("下载cfssl地址：")]),s._v("https://pkg.cfssl.org/")]),s._v(" "),r("h3",{attrs:{id:"_2-1-1-加压安装cfssl工具"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-加压安装cfssl工具"}},[s._v("#")]),s._v(" 2.1.1 加压安装cfssl工具")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.解压安装cfssl工具，以便给etcd和k8s生成证书'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tar "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xvf "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gz \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),s._v("\ncfssl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh            "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 安装cfssl的脚本，可以使用这个脚本到官网去下载cfssl相关组件")]),s._v("\ncfssl              "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// cfssl是用来生成自签生成证书的")]),s._v("\ncfssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certinfo \ncfssljson  \n\netcd               "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 存放k8s中的组件etcd文件夹")]),s._v("\nk8s                "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 存放k8s中的k8s组件文件夹")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfssl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh           # 实质就是将cfssl、cfssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certinfo、cfssljson 拷贝到"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin目录，才能系统运行\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ls "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("     # 可以看到文件以及被拷贝到"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("文件夹下了\ncfssl  cfssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certinfo  cfssljson\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])]),r("h3",{attrs:{id:"_2-1-2-tls-tar-gz中文件说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-tls-tar-gz中文件说明"}},[s._v("#")]),s._v(" 2.1.2 TLS.tar.gz中文件说明")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tree "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n├── cfssl\n├── cfssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certinfo\n├── cfssljson\n├── cfssl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n├── etcd        # etcd数据库颁发"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("证书的文件夹\n│   ├── generate_etcd_cert"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n│   ├── ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n│   └── server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n│   ├── ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n└── k8s        # 为kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver和kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy颁发"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("证书的文件夹   \n    ├── generate_k8s_cert"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh         # 生成证书的脚本\n    ├── ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n    ├── ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n    ├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n    └── server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br")])]),r("h2",{attrs:{id:"_2-2-为etcd组件签发证书"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-为etcd组件签发证书"}},[s._v("#")]),s._v(" 2.2 为etcd组件签发证书")]),s._v(" "),r("p",[s._v("==/root/TLS/etcd有三个.json文件用来配置CA证书==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tree "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n├── ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json         # "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("自己的配置文件")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("机构里的一些属性，比如域名有效期等"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("自己创建"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n├── ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json           # "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("的配置文件")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("自己创建"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n├── generate_etcd_cert"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh    # 用于自建"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("颁发证书脚本命令\n└── server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json        # 要对那些域名来颁发"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("证书的配置文件")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("自己创建"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("h3",{attrs:{id:"_2-2-1-server-csr-json要对那些域名来颁发ca证书"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-server-csr-json要对那些域名来颁发ca证书"}},[s._v("#")]),s._v(" 2.2.1 server-csr.json要对那些域名来颁发CA证书")]),s._v(" "),r("ul",[r("li",[r("code",[s._v("指定可信任的ip地址，是所有包含etcd节点的IP")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("         # "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CN")]),s._v("的名字是随便取\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           # 可信任的ip地址，是所有包含etcd节点的"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("（这里在下面三台机器都部署了etcd）\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.56.63"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.56.65"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.56.66"')]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("            # 加密算法和长度\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("           # 属性信息，那个国家、那个城市等\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br")])]),r("h3",{attrs:{id:"_2-2-2-ca-config-json是ca机构里的一些属性-无需改动"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-ca-config-json是ca机构里的一些属性-无需改动"}},[s._v("#")]),s._v(" 2.2.2 ca-config.json是CA机构里的一些属性:"),r("code",[s._v("无需改动")])]),s._v(" "),r("ul",[r("li",[r("code",[s._v("配置CA机构里的一些属性：比如域名有效期等")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"signing"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"expiry"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"87600h"')]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"profiles"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"www"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"expiry"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"87600h"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n         "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"usages"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"signing"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key encipherment"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"server auth"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client auth"')]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br")])]),r("h3",{attrs:{id:"_2-2-3-ca-csr-json是ca的配置文件-无需改动"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-ca-csr-json是ca的配置文件-无需改动"}},[s._v("#")]),s._v(" 2.2.3 ca-csr.json是CA的配置文件:"),r("code",[s._v("无需改动")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd CA"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Beijing"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Beijing"')]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br")])]),r("h3",{attrs:{id:"_2-2-4-generate-etcd-cert-sh生成ca和证书命令脚本"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-generate-etcd-cert-sh生成ca和证书命令脚本"}},[s._v("#")]),s._v(" 2.2.4 generate_etcd_cert.sh生成ca和证书命令脚本")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat generate_etcd_cert"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\ncfssl gencert "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("initca ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bare ca "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\ncfssl gencert "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("profile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("www server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bare server\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("h3",{attrs:{id:"_2-2-5-为etcd颁发证书"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-为etcd颁发证书"}},[s._v("#")]),s._v(" 2.2.5 为etcd颁发证书")]),s._v(" "),r("h4",{attrs:{id:"_2-2-5-1-使用cfssl创建一个ca机构证书"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-1-使用cfssl创建一个ca机构证书"}},[s._v("#")]),s._v(" 2.2.5.1 使用cfssl创建一个CA机构证书")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'初始化一个CA机构 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd\ngenerate_etcd_cert"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh        "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用于自建CA的脚本")]),s._v("\nserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json            "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 要对那些域名来颁发CA证书的配置文件")]),s._v("\nca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json             "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// CA自己的配置文件(CA机构里的一些属性，比如域名有效期等)")]),s._v("\nca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json               "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// CA的配置文件")]),s._v("\n# 初始化一个"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("机构，生成"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("的公钥和私钥，用来颁发域名证书\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cfssl gencert "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("initca ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bare ca "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("    # 初始化一个"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("机构（下面两个文件）\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ls "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("pem                                      # 查看到已经生成了ca的公钥和私钥\nca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem    "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// CA的私钥(key)")]),s._v("\nca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem       "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// CA机构的数字证书(公钥)")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("h4",{attrs:{id:"_2-2-5-2-正式为etcd颁发服务证书"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-2-正式为etcd颁发服务证书"}},[s._v("#")]),s._v(" 2.2.5.2 正式为etcd颁发服务证书")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'使用 cfssl工具和上面的配置文件，正式为etcd颁发证书  '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n# 命令解析 \n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem             "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 指定使用哪一个CA机构")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem       "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 指定CA的key")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json    "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// CA自己的配置文件")]),s._v("\nserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json         "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 颁发CA证书的配置文件")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bare server           "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 生成以server开头的证书名称")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cfssl gencert "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("profile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("www server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bare server\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ls "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("pem   # 需要用到的有下面四个"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem         "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// CA的私钥(key)")]),s._v("\nca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem            "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// CA机构的数字证书")]),s._v("\nserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem      "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 上面为etcd服务刚刚颁发的key")]),s._v("\nserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem         "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 上面为etcd服务刚刚颁发的证书")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])]),r("h2",{attrs:{id:"_2-3-为kube-apiserver、kube-proxy签发证书"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-为kube-apiserver、kube-proxy签发证书"}},[s._v("#")]),s._v(" 2.3 为kube-apiserver、kube-proxy签发证书")]),s._v(" "),r("ul",[r("li",[s._v("==为kube-apiserver和kube-proxy颁发CA证书==")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tree "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n├── ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json            # "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("自己的配置文件")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("机构里的一些属性，比如域名有效期等"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n├── ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json              # "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("的配置文件\n├── generate_k8s_cert"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh        # 用于自建"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("颁发证书脚本命令\n├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json         # 要对那些域名来颁发"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("证书的配置文件\n└── server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json            # 要对那些域名来颁发"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("证书的配置文件\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("h3",{attrs:{id:"_2-3-1-ca-config-json-ca机构配置属性-无需改动"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-ca-config-json-ca机构配置属性-无需改动"}},[s._v("#")]),s._v(" 2.3.1 ca-config.json:CA机构配置属性:无需改动")]),s._v(" "),r("p",[s._v("==CA自己的配置文件(CA机构里的一些属性，比如域名有效期等)==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"signing"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"expiry"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"87600h"')]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"profiles"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"expiry"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"87600h"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n         "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"usages"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"signing"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key encipherment"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"server auth"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client auth"')]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br")])]),r("h3",{attrs:{id:"_2-3-2-ca-csr-json-ca配置文件-无需改动"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-ca-csr-json-ca配置文件-无需改动"}},[s._v("#")]),s._v(" 2.3.2 ca-csr.json:CA配置文件:无需改动")]),s._v(" "),r("p",[s._v("==CA的配置文件==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Beijing"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Beijing"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      \t    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"O"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"System"')]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br")])]),r("h3",{attrs:{id:"_2-3-3-kube-proxy-csr-json-ca为kube-proxy颁发证书配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-kube-proxy-csr-json-ca为kube-proxy颁发证书配置文件"}},[s._v("#")]),s._v(" 2.3.3 kube-proxy-csr.json:CA为kube-proxy颁发证书配置文件")]),s._v(" "),r("p",[s._v("==要对那些域名来颁发CA证书的配置文件==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"system:kube-proxy"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"O"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"System"')]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br")])]),r("h3",{attrs:{id:"_2-3-4-server-csr-json-修改需要访问apiserver地址"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4-server-csr-json-修改需要访问apiserver地址"}},[s._v("#")]),s._v(" 2.3.4 server-csr.json:修改需要访问apiserver地址")]),s._v(" "),r("ul",[r("li",[s._v("要对kube-apiserver颁发CA证书配置文件")]),s._v(" "),r("li",[s._v("指定都有哪些ip会访问我这个kube-apiserver可以多写一些，以免添加node节点要重新颁发证书")]),s._v(" "),r("li",[s._v("k8s-node1和k8s-node2一般不需要添加")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    # 证书添加可信任"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("      # kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver中第一个地址，默认用作apiserver负载均衡\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      # k8s官方内部访问kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver时需要用到的域名，也要添加\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.default"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.default.svc"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.default.svc.cluster"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes.default.svc.cluster.local"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      \n      # 指定都有哪些ip会访问我这个kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver可以多写一些，以免添加node节点要重新颁发证书\n      # 在本次实验中有：kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1、kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master2、Load "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("Balancer")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Master"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("、Load "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("Balancer")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Backup"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      # k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1和k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2一般不需要添加\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.31.60"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.31.61"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.31.62"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.31.63"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.31.64"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"algo"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"names"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"C"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"L"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ST"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"O"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"System"')]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br"),r("span",{staticClass:"line-number"},[s._v("36")]),r("br"),r("span",{staticClass:"line-number"},[s._v("37")]),r("br")])]),r("h3",{attrs:{id:"_2-3-5-generate-k8s-cert-sh-自建ca和证书脚本"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-5-generate-k8s-cert-sh-自建ca和证书脚本"}},[s._v("#")]),s._v(" 2.3.5 generate_k8s_cert.sh:自建CA和证书脚本")]),s._v(" "),r("p",[s._v("==用于自建CA,颁发证书脚本命令==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat generate_k8s_cert"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat generate_k8s_cert"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh \n# 创建"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("机构\ncfssl gencert "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("initca ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bare ca "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n# 为k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver颁发证书\ncfssl gencert "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("profile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bare server\n# 为kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy颁发证书\ncfssl gencert "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("profile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bare kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("h3",{attrs:{id:"_2-3-6-为kube-apiserver和kube-proxy生成证书"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-6-为kube-apiserver和kube-proxy生成证书"}},[s._v("#")]),s._v(" 2.3.6 为kube-apiserver和kube-proxy生成证书")]),s._v(" "),r("h4",{attrs:{id:"_2-3-6-1-执行生成证书脚本"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-6-1-执行生成证书脚本"}},[s._v("#")]),s._v(" 2.3.6.1 执行生成证书脚本")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("generate_k8s_cert"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h4",{attrs:{id:"_2-3-6-2-会生成3对证书说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-6-2-会生成3对证书说明"}},[s._v("#")]),s._v(" 2.3.6.2 会生成3对证书说明")]),s._v(" "),r("ul",[r("li",[s._v("==CA机构、kube-proxy、kube-apiserver==")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k8s\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ls "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("pem\nca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem  ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem                  # "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("机构的私钥和证书\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem  kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem       # kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy的私钥和证书，以便k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node通信\nserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem  server"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem            # kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver的证书和私钥\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("h1",{attrs:{id:"_03-etcd数据库集群部署"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_03-etcd数据库集群部署"}},[s._v("#")]),s._v(" 03.Etcd数据库集群部署")]),s._v(" "),r("p",[s._v("==在 k8s-master1-192.168.56.63 中执行以下操作==")]),s._v(" "),r("p",[s._v("Etcd下载地址：https://github.com/etcd-io/etcd/releases")]),s._v(" "),r("p",[s._v("==下面三台机器都要部署etcd集群==")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("192.168.56.63    k8s-master1\n192.168.56.65    k8s-node1\n192.168.56.66    k8s-node2\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("h2",{attrs:{id:"_3-1-etcd介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-etcd介绍"}},[s._v("#")]),s._v(" 3.1 Etcd介绍")]),s._v(" "),r("ul",[r("li",[s._v("etcd是CoreOS团队的开源项目，是构建一个高可用的分布式键值(key-value)数据库。")]),s._v(" "),r("li",[s._v("etcd比较多的应用场景是用于服务发现，和共享配置")]),s._v(" "),r("li",[s._v("etcd是由多个节点整体构建，对外服务的，每个节点都存储完整的数据")]),s._v(" "),r("li",[s._v("etcd有一个主服务负责写数据，然后同步到其他从节点")]),s._v(" "),r("li",[s._v("当主服务挂掉后，会选举一个从服务成为新的主节点（所以一般etcd部署数量是基数个）")])]),s._v(" "),r("h2",{attrs:{id:"_3-2-解压etcd-tar-gz域文件说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-解压etcd-tar-gz域文件说明"}},[s._v("#")]),s._v(" 3.2 解压etcd.tar.gz域文件说明")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tar "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xvf etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gz       # 解压后会有下面两个文件\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tree "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd\n├── etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service              # 配置如何启动etcd的服务的文件\n├── bin                     \n│   ├── etcd\n│   └── etcdctl\n├── cfg\n│   └── etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf            # etcd配置文件\n└── ssl\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br")])]),r("h2",{attrs:{id:"_3-3-etcd服务启动配置文件说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-etcd服务启动配置文件说明"}},[s._v("#")]),s._v(" 3.3 etcd服务启动配置文件说明")]),s._v(" "),r("h3",{attrs:{id:"_3-3-1-etcd-service"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-etcd-service"}},[s._v("#")]),s._v(" 3.3.1 etcd.service")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd etcd\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nDescription"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Etcd Server\nAfter"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target\nAfter"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("online"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target\nWants"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("online"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nType"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("notify\nEnvironmentFile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf               # 指定etcd服务配置文件位置\nExecStart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd \\\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_NAME")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \\\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("data"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_DATA_DIR")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \\\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("listen"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("peer"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("urls"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_LISTEN_PEER_URLS")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \\\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("listen"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("urls"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("http"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v(" \\\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("advertise"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("urls"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \\\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("advertise"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("peer"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("urls"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \\\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_CLUSTER")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \\\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \\\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("state"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")])]),s._v("\n        \n        # 其他客户端调用etcd使用的证书\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("trusted"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\      # 指定自签证书"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("文件位置\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("cert"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\       # 上面"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("机构颁发的数字证书\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\      # 上面"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("机构颁发的私钥\n        \n        # etcd集群内部端口使用的证书\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("peer"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("peer"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("peer"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("trusted"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\nRestart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("failure\nLimitNOFILE"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nWantedBy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br"),r("span",{staticClass:"line-number"},[s._v("36")]),r("br")])]),r("h3",{attrs:{id:"_3-3-2-etcd-conf"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-etcd-conf"}},[s._v("#")]),s._v(" 3.3.2 etcd.conf")]),s._v(" "),r("ul",[r("li",[s._v("==主要是修改etcd中的ip和当前机器ip对应==")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf      # 编辑etcd的配置文件\n#"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Member"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_NAME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd-1"')]),s._v("                             # etcd名称随便取，但是在集群内唯一\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_DATA_DIR")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/etcd/default.etcd"')]),s._v("            # etcd数据存放的位置\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_LISTEN_PEER_URLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.63:2380"')]),s._v("       # etcd内部通信的ip和端口\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.63:2379"')]),s._v("     # 外部程序会使用这个ip和端口来对etcd操作\n\n#"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Clustering"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.63:2380"')]),s._v("    # 集群通告的地址\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.63:2379"')]),s._v("        # 外部程序会使用这个ip和端口来对etcd操作\n### 集群中所有节点信息： 节点名称"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ip"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("端口\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_CLUSTER")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd-1=https://192.168.56.63:2380,etcd-2=https://192.168.56.65:2380,etcd-3=https://192.168.56.66:2380"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd-cluster"')]),s._v("                  # 集群内部通信简单的token认证\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_CLUSTER_STATE")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"new"')]),s._v("                        # 集群的状态："),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v("（新集群）  "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("exsiting")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("集群加入新节点"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br")])]),r("h2",{attrs:{id:"_3-4-将cfssl生成的证书拷贝到ssl文件夹下"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-将cfssl生成的证书拷贝到ssl文件夹下"}},[s._v("#")]),s._v(" 3.4 将cfssl生成的证书拷贝到ssl文件夹下")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 ssl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h2",{attrs:{id:"_3-5-将etcd配置文件统一下发到所有etcd节点机器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-将etcd配置文件统一下发到所有etcd节点机器"}},[s._v("#")]),s._v(" 3.5 将etcd配置文件统一下发到所有etcd节点机器")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.下发etcd配置文件到三台机器的/opt/文件夹中 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# scp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd   root@"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("            # k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# scp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd   root@"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".65")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("            # k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# scp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd   root@"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("            # k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2\n \n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.下发etcd启动文件到/usr/lib/systemd/system中 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# scp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service   root@"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("systemd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system            # k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# scp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service   root@"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".65")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("systemd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system            # k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# scp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service   root@"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("systemd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system            # k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br")])]),r("h2",{attrs:{id:"_3-6-修改其他两台etcd中配置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-修改其他两台etcd中配置"}},[s._v("#")]),s._v(" 3.6 修改其他两台etcd中配置")]),s._v(" "),r("p",[s._v("==修改k8s-node1-192.168.56.65中etcd配置文件==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \n#"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Member"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_NAME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd-2"')]),s._v("                              # 修改etcd名字\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_DATA_DIR")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/etcd/default.etcd"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_LISTEN_PEER_URLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.65:2380"')]),s._v("        # 所有ip修改成当前机器的物理ip\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.65:2379"')]),s._v("\n\n#"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Clustering"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.65:2380"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.65:2379"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_CLUSTER")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd-1=https://192.168.56.63:2380,etcd-2=https://192.168.56.65:2380,etcd-3=https://192.168.56.66:2380"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd-cluster"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_CLUSTER_STATE")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"new"')]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])]),r("p",[s._v("==修改k8s-node2-192.168.56.66中etcd配置文件==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \n#"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Member"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_NAME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd-3"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_DATA_DIR")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/lib/etcd/default.etcd"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_LISTEN_PEER_URLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.66:2380"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.66:2379"')]),s._v("\n\n#"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Clustering"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.66:2380"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.66:2379"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_CLUSTER")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd-1=https://192.168.56.63:2380,etcd-2=https://192.168.56.65:2380,etcd-3=https://192.168.56.66:2380"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd-cluster"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCD_INITIAL_CLUSTER_STATE")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"new"')]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])]),r("h2",{attrs:{id:"_3-7-启动etcd服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-启动etcd服务"}},[s._v("#")]),s._v(" 3.7 启动etcd服务")]),s._v(" "),r("p",[s._v("==k8s-master1 / k8s-node1 / k8s-node2 三台机器都要启动==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl daemon"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("reload      # 重新载入配置\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl start etcd        # 启动etcd\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 ssl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl enable etcd      # 设置etcd服务开机自启动\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 ssl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tail "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("messages "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f           # 查看etcd日志（etcd的日志存放在系统日志中）\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("p",[s._v("==查看etcd集群状态==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  \n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcdctl \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("cert"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("endpoints"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.56.63:2379,https://192.168.56.65:2379,https://192.168.56.66:2379"')]),s._v(" \\\ncluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("health\n\n#################  输出下面信息，证明etcd集群服务正常 #####################\nmember "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("498280")]),s._v("cf84315325 is healthy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" got healthy result "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".65")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v("\nmember "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("db6a5f8c1a09bff is healthy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" got healthy result "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v("\nmember bd02d01955e959f9 is healthy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" got healthy result "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v("\ncluster is healthy\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("h1",{attrs:{id:"_04-k8s-master1部署apiserver、controller-manager、scheduler"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_04-k8s-master1部署apiserver、controller-manager、scheduler"}},[s._v("#")]),s._v(" 04.k8s-master1部署apiserver、controller-manager、scheduler")]),s._v(" "),r("h2",{attrs:{id:"_4-1-下载k8s-master二进制包-包含所有组件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-下载k8s-master二进制包-包含所有组件"}},[s._v("#")]),s._v(" 4.1 下载k8s-master二进制包(包含所有组件)")]),s._v(" "),r("blockquote",[r("p",[r("strong",[s._v("下载的二进制包包含 k8s-master和 k8s-node节点中所需的所有组件")])]),s._v(" "),r("p",[r("code",[s._v("kube-apiserver kube-controller-manager kubectl kube-scheduler")])])]),s._v(" "),r("ul",[r("li",[r("p",[s._v("进入GitHub中的k8s仓库：https://github.com/kubernetes/kubernetes/")]),s._v(" "),r("ul",[r("li",[r("img",{staticStyle:{width:"800px","margin-left":"0px"},attrs:{src:a(634)}})])])]),s._v(" "),r("li",[r("p",[s._v("跳转到：https://github.com/kubernetes/kubernetes/releases")])]),s._v(" "),r("li",[r("p",[s._v("下载1.16.11版本：https://github.com/kubernetes/kubernetes/releases/tag/v1.16.11")]),s._v(" "),r("ul",[r("li",[r("img",{staticStyle:{width:"800px","margin-left":"0px"},attrs:{src:a(635)}})])])]),s._v(" "),r("li",[r("p",[s._v("https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.16.md#v11611")]),s._v(" "),r("ul",[r("li",[s._v("一定要看清楚，下载k8s server二进制包(Server binaries),这个包包含了k8s-master和k8s-node所需所有组件")]),s._v(" "),r("li",[r("img",{staticStyle:{width:"800px","margin-left":"0px"},attrs:{src:a(636)}})])])])]),s._v(" "),r("h2",{attrs:{id:"_4-2-部署apiserver、controller-manager、scheduler"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-部署apiserver、controller-manager、scheduler"}},[s._v("#")]),s._v(" 4.2 部署apiserver、controller-manager、scheduler")]),s._v(" "),r("p",[s._v("==将k8s-master.tar.gz拖入到/root/下==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tar "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xvf k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gz \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tree "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service             # kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver启动文件\n├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service       # kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager启动文件\n├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service             # kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler启动文件\n                  \n├── kubernetes    # 文件夹：k8s服务中下载的组件拷贝到这个文件夹中（如果是其他版本，自行复制对应版本组件放到这里）\n    ├── bin     # 四个可执行文件，都是下载k8s服务的二进制包\n    │   ├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver\n    │   ├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager\n    │   ├── kubectl\n    │   └── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler\n    ├── cfg\n    │   ├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n    │   ├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n    │   ├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n    │   └── token"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csv\n    ├── logs\n    └── ssl \n "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 ssl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*pem /root/kubernetes/ssl/    # 将刚刚为kube-apiserver和kube-proxy颁发的证书拷贝到ssl文件夹\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br")])]),r("h3",{attrs:{id:"_4-4-1-三个服务管理脚本"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-三个服务管理脚本"}},[s._v("#")]),s._v(" 4.4.1 三个服务管理脚本")]),s._v(" "),r("ul",[r("li",[r("code",[s._v("apiserver、controller-manager、scheduler")])])]),s._v(" "),r("h4",{attrs:{id:"_4-1-1-1-kube-apiserver-service"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1-1-kube-apiserver-service"}},[s._v("#")]),s._v(" 4.1.1.1 kube-apiserver.service")]),s._v(" "),r("ul",[r("li",[s._v("==kube-apiserver启动管理脚本==")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nDescription"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Kubernetes "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("API")]),s._v(" Server\nDocumentation"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("github"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nEnvironmentFile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\nExecStart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("KUBE_APISERVER_OPTS")]),s._v("\nRestart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("failure\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nWantedBy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br")])]),r("h4",{attrs:{id:"_4-4-1-2-kube-controller-manager-service"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-2-kube-controller-manager-service"}},[s._v("#")]),s._v(" 4.4.1.2 kube-controller-manager.service")]),s._v(" "),r("ul",[r("li",[s._v("==kube-controller-manager启动管理脚本==")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nDescription"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Kubernetes Controller Manager\nDocumentation"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("github"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nEnvironmentFile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\nExecStart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("KUBE_CONTROLLER_MANAGER_OPTS")]),s._v("\nRestart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("failure\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nWantedBy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br")])]),r("h4",{attrs:{id:"_4-4-1-3-kube-scheduler-service"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-3-kube-scheduler-service"}},[s._v("#")]),s._v(" 4.4.1.3 kube-scheduler.service")]),s._v(" "),r("ul",[r("li",[s._v("==kube-scheduler服务启动管理脚本==")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nDescription"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Kubernetes Scheduler\nDocumentation"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("github"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nEnvironmentFile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\nExecStart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("KUBE_SCHEDULER_OPTS")]),s._v("\nRestart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("failure\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nWantedBy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br")])]),r("h3",{attrs:{id:"_4-4-2-kube-apiserver-conf配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-2-kube-apiserver-conf配置文件"}},[s._v("#")]),s._v(" 4.4.2 kube-apiserver.conf配置文件")]),s._v(" "),r("blockquote",[r("p",[r("code",[s._v("注： kube-apiserver.conf 只需要修改 连接etcd地址和kube-apiserver绑定地址即可，其他保持默认")])]),s._v(" "),r("p",[s._v("==更多配置文件请参考官方：==https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/")]),s._v(" "),r("p",[r("code",[s._v("https://kubernetes.io/")]),s._v(" =》 Documentation =》Reference =》 Command line tools reference")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("KUBE_APISERVER_OPTS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v('"'),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("logtostderr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("v"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" \\                                    # 指定k8s服务输出日志级别\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs \\                  # 指定输出的k8s日志存放路径\n\n# 配置当前 kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver连接那几个 etcd数据库\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("servers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".65")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("bind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),s._v(" \\                   # 当前 kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("apiserver绑定的地址")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("本机地址"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("secure"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v(" \\                          # 当前 kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver绑定的端口号\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("advertise"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),s._v(" \\                #  kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver通告地址，告诉其他的k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node机器用哪个地址来连接当前apiserver\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("allow"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("privileged"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" \\                       # 运行创建容器时可以使用超级权限\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ip"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("range"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" \\             # service服务发现时指定虚拟ip地址段\n# 启用准入控制插件，k8s高级功能，比如：资源配额限制，node自动注册等\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("enable"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admission"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugins"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NamespaceLifecycle"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("LimitRanger"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ServiceAccount"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ResourceQuota"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("NodeRestriction \\     \n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("mode"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RBAC")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Node \\                  # 授权模式：为指定用户赋予权限，访问api时使用"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RBAC")]),s._v("来判断是否有权限\n\n# 启用bootstrap"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token功能，当机器很多事可以自动为kubelet颁发证书\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("enable"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bootstrap"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" \\                \n\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("token"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("token"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csv \\        # 指定token的位置路径\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("range"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30000")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("32767")]),s._v(" \\               # k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node服务启动的端口号范围\n\n# 配置kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver连接kubelet使用的证书\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certificate"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\        \n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n# 配置 kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver使用https时使用的证书\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("tls"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem  \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("tls"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n# service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("account使用的私钥\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("account"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\         # \n# 连接etcd时使用的证书\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cafile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certfile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keyfile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n\n# apiserver日志相关配置\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("audit"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("maxage"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("audit"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("maxbackup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("audit"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("maxsize"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("audit"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("path"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("audit"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v('log"            \n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br"),r("span",{staticClass:"line-number"},[s._v("36")]),r("br"),r("span",{staticClass:"line-number"},[s._v("37")]),r("br"),r("span",{staticClass:"line-number"},[s._v("38")]),r("br"),r("span",{staticClass:"line-number"},[s._v("39")]),r("br"),r("span",{staticClass:"line-number"},[s._v("40")]),r("br"),r("span",{staticClass:"line-number"},[s._v("41")]),r("br"),r("span",{staticClass:"line-number"},[s._v("42")]),r("br")])]),r("h3",{attrs:{id:"_4-4-3-kube-controller-manager-conf配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-3-kube-controller-manager-conf配置文件"}},[s._v("#")]),s._v(" 4.4.3 kube-controller-manager.conf配置文件")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \n# 日志相关配置\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("KUBE_CONTROLLER_MANAGER_OPTS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v('"'),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("logtostderr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("v"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs \\\n\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("leader"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("elect"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" \\                      # 集群选举\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("master"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" \\                   # 指定连接 kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver的ip地址（apiserver默认会监听"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("端口，无需额外配置）\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("address"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" \\\n\n# 允许安装cni插件，cni插件能自动分配ip\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("allocate"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cidrs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cidr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ip"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("range"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" \\       # 指定集群pod分配的ip段\n\n# 集群签名的两个证书"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("当node加入集群时为他颁发证书的ca\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("signing"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("signing"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem  \\\n\n# 用于签发service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("account时的"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("account"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n\n# 为每个node颁发证书的有效期："),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("年\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("experimental"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("signing"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("duration"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("87600")]),s._v('h0m0s"\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br")])]),r("h3",{attrs:{id:"_4-4-4-kube-scheduler-conf配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-4-kube-scheduler-conf配置文件"}},[s._v("#")]),s._v(" 4.4.4 kube-scheduler.conf配置文件")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \n# 基本日志配置\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("KUBE_SCHEDULER_OPTS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v('"'),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("logtostderr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("v"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs \\\n\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("leader"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("elect \\                       # 指定参加集群中的kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler选举\n\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("master"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" \\                # 指定连接 kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver的ip地址（apiserver默认会监听"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("端口，无需额外配置）\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("address"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v('"\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("h3",{attrs:{id:"_4-4-5-token-csv"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-5-token-csv"}},[s._v("#")]),s._v(" 4.4.5 token.csv")]),s._v(" "),r("p",[s._v("==在node中只要携带下面这个token值，就可以为其自动颁发证书,不过需要对kubelet-bootstrap赋权==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat token"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csv \nc47ffb939f5ca36231d9e3121a252940"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bootstrap"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10001")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"system:node-bootstrapper"')]),s._v("\n\n####  格式：token"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 用户"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" uid"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 用户组   ####\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("h3",{attrs:{id:"_4-4-6-grep检查是否所有ip都被正确修改"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-6-grep检查是否所有ip都被正确修改"}},[s._v("#")]),s._v(" 4.4.6 grep检查是否所有ip都被正确修改")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# grep "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n/root/kubernetes/cfg/kube-apiserver.conf:--etcd-servers=https://192.168.56.63:2379,https://192.168.56.65:2379,https://192.168.56.66:2379 \\\n/root/kubernetes/cfg/kube-apiserver.conf:--bind-address=192.168.56.63 \\\n/root/kubernetes/cfg/kube-apiserver.conf:--advertise-address=192.168.56.63 \\\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("h3",{attrs:{id:"_4-4-7-将3个-service文件移动到工作目录下并启动服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-7-将3个-service文件移动到工作目录下并启动服务"}},[s._v("#")]),s._v(" 4.4.7 将3个.service文件移动到工作目录下并启动服务")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.将 /root/kubernetes/下的配置文件全部拷贝到工作目录 /opt/ 文件夹下 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n# 必须确保为kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver、kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy签发证书\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token regex"}},[r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("opt")]),r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.将kube-apiserver、kube-controller-manager、kube-scheduler管理命令移动到系统工作路径下'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# mv kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("systemd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system\n\n "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.启动kube-apiserver '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl start kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl enable kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ps "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ef "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ls "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("             # kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver所有日志都在这里\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4.启动kube-controller-manager'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl start kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl enable kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tail "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INFO")]),s._v(" \n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'5.启动kube-scheduler'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl start kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl enable kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tail "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INFO")]),s._v(" \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br")])]),r("h3",{attrs:{id:"_4-4-8-将kubectl移动到系统变量中"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-8-将kubectl移动到系统变量中"}},[s._v("#")]),s._v(" 4.4.8 将kubectl移动到系统变量中")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubectl "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" node        # 查看当前k8s中节点\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" cs         # 查看当前集群\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                 "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\nscheduler            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unknown"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ncontroller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unknown"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\netcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unknown"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\netcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unknown"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\netcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unknown"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br")])]),r("h3",{attrs:{id:"_4-4-9-为kubelet-bootstrap授权"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-9-为kubelet-bootstrap授权"}},[s._v("#")]),s._v(" 4.4.9 为kubelet-bootstrap授权")]),s._v(" "),r("p",[s._v("==在token.csv文件中虽然配置了kubelet-bootstrap账号可以为新加入 k8s-node自动颁发证书，但是需要进行授权==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# \nkubectl create clusterrolebinding kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bootstrap \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("clusterrole"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("node"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bootstrapper \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("user"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bootstrap\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("h1",{attrs:{id:"_05-k8s-node1中部署kubelet、kube-proxy"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_05-k8s-node1中部署kubelet、kube-proxy"}},[s._v("#")]),s._v(" 05.k8s-node1中部署kubelet、kube-proxy")]),s._v(" "),r("p",[s._v("==将k8s-node.tar.gz包上传到k8s-node1的/root/下==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tar "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xvf k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gz\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tree "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n├── cni"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugins"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("linux"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v0"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.2")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tgz            # cni二进制插件\n├── daemon"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json                            # docker的配置文件\n├── docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.09")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".6")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tgz                        # docker的二进制文件，离线安装docker\n├── docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service                           # docker的服务管理命令\n├── k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gz                          # k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node节点配置\n├── kubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service                          # kubelet服务管理命令\n├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service                        # kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy服务管理命令\n└── kubernetes\n    ├── bin\n    │   ├── kubelet                       # k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master会自动给kubelet颁发证书\n    │   └── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy                     # kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy证书要从k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master上下发过来\n    ├── cfg\n    │   ├── bootstrap"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig\n    │   ├── kubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n    │   ├── kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml\n    │   ├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n    │   ├── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml\n    │   └── kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig\n    ├── logs\n    └── ssl\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br")])]),r("h2",{attrs:{id:"_5-1-配置文件说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-配置文件说明"}},[s._v("#")]),s._v(" 5.1 配置文件说明")]),s._v(" "),r("p",[s._v("==.service结尾的是服务管理命令配置文件==\n==.conf后缀的是服务主配置文件==\n==.yml 结尾的也是一些服务主要的配置文件==\n==.kubeconfig结尾的是连接kube-apiserver配置文件==")]),s._v(" "),r("h3",{attrs:{id:"_5-1-1-docker安装配置相关文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-docker安装配置相关文件"}},[s._v("#")]),s._v(" 5.1.1 docker安装配置相关文件")]),s._v(" "),r("h4",{attrs:{id:"_5-1-1-1-docker-service"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-1-docker-service"}},[s._v("#")]),s._v(" 5.1.1.1 docker.service")]),s._v(" "),r("p",[s._v("==docker服务管理命令：无需修改==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nDescription"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Docker Application Container Engine\nDocumentation"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docs"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\nAfter"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("online"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target firewalld"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service containerd"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service\nWants"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("online"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nType"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("notify\nExecStart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dockerd\nExecReload"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kill "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HUP")]),s._v(" $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MAINPID")]),s._v("\nTimeoutSec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nRestartSec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nRestart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always\nStartLimitBurst"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nStartLimitInterval"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("s\nLimitNOFILE"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("infinity\nLimitNPROC"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("infinity\nLimitCORE"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("infinity\nTasksMax"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("infinity\nDelegate"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\nKillMode"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("process\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nWantedBy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br")])]),r("h4",{attrs:{id:"_5-1-1-2-daemon-json"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-2-daemon-json"}},[s._v("#")]),s._v(" 5.1.1.2 daemon.json")]),s._v(" "),r("p",[s._v("==配置docker一些属性==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daemon"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://bc437cce.m.daocloud.io"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("            # 配置docker镜像加速地址\n    "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.31.70"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("                     # 自建镜像仓库的可信任地址\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("h4",{attrs:{id:"_5-1-1-3-安装docker"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-3-安装docker"}},[s._v("#")]),s._v(" 5.1.1.3 安装docker")]),s._v(" "),r("blockquote",[r("p",[r("code",[s._v("docker二进制包下载：")]),s._v("https://download.docker.com/linux/static/stable/x86_64/")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.二进制方式安装docker '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tar xvf docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.09")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".6")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tgz\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# mv "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* /usr/bin/      # 这样就完成了docker的安装，和yum安装的方式效果完全一致\n[root@k8s-node1 ~]# docker                    # 测试docker是否安装成功\n'''2.docer服务管理命令移动到系统工作目录下 '''\n[root@k8s-node1 ~]# mv /root/docker.service /usr/lib/systemd/system        # 将docker启动停止的管理命令移动到系统路径下\n'''3.docker属性配置目录 '''\n[root@k8s-node1 ~]# mkdir /etc/docker                        # docker属性配置文件默认在此文件夹中\n[root@k8s-node1 ~]# mv /root/daemon.json /etc/docker/             # 将docker属性配置文件 deamon.json移动到指定文件夹，以便docker加载\n \n'''4.docker管理命令 '''\n[root@k8s-node1 ~]# systemctl start docker\n[root@k8s-node1 ~]# systemctl enable docker\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br")])]),r("h3",{attrs:{id:"_5-1-2-kubelet服务安装相关配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-kubelet服务安装相关配置文件"}},[s._v("#")]),s._v(" 5.1.2 kubelet服务安装相关配置文件")]),s._v(" "),r("h4",{attrs:{id:"_5-1-2-0-kubelet启动流程图解"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-0-kubelet启动流程图解"}},[s._v("#")]),s._v(" 5.1.2.0 kubelet启动流程图解")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"600px","margin-left":"20px"},attrs:{src:a(637)}})]),s._v(" "),r("h4",{attrs:{id:"_5-1-2-1-kubelet-service-无需修改"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-1-kubelet-service-无需修改"}},[s._v("#")]),s._v(" 5.1.2.1 kubelet.service:无需修改")]),s._v(" "),r("p",[s._v("==.service结尾的是服务管理命令配置文件：无需修改==")]),s._v(" "),r("ul",[r("li",[s._v("指定kubelet.conf路径")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nDescription"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Kubernetes Kubelet\nAfter"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service\nBefore"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nEnvironmentFile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\nExecStart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubelet $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("KUBELET_OPTS")]),s._v("\nRestart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("failure\nLimitNOFILE"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nWantedBy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br")])]),r("h4",{attrs:{id:"_5-1-2-2-kubelet-conf"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-2-kubelet-conf"}},[s._v("#")]),s._v(" 5.1.2.2  kubelet.conf")]),s._v(" "),r("p",[s._v("==.conf后缀的是服务主配置文件:无需修改==")]),s._v(" "),r("ul",[r("li",[r("code",[s._v("配置当前节点注册到k8s中显示的名称，保持唯一")])]),s._v(" "),r("li",[s._v("指定kubelet.kubeconfig、bootstrap.kubeconfig、kubelet-config.yml配置文件路径")]),s._v(" "),r("li",[s._v("指定k8s-master1中颁发证书的路径")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \n# 基本日志配置\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("KUBELET_OPTS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v('"'),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("logtostderr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("v"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs \\\n\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("hostname"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("override"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 \\                              # 配置当前节点注册到k8s中显示的名称，保持唯一\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("network"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cni \\                                    # 启动网络插件 cni\n\n# 指定三个配置文件路径\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("kubeconfig"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig \\               # 颁发证书时会自动生成这个配置文件 \n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("bootstrap"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kubeconfig"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bootstrap"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig \\\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml \\\n\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("cert"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl \\                             # 指定k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master为我自动颁发的证书我存放到那个路径下\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("pod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("infra"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("container"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("lizhenliang"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pause"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v('"            # 启动每一个pod都会先启动这一个镜像，这个镜像主要管理pod的命名空间\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br")])]),r("h4",{attrs:{id:"_5-1-2-3-kubelet-config-yml-无需改动"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-3-kubelet-config-yml-无需改动"}},[s._v("#")]),s._v(" 5.1.2.3 kubelet-config.yml:无需改动")]),s._v(" "),r("p",[s._v("==.yml 结尾的也是一些服务主要的配置文件:无需修改==")]),s._v(" "),r("ul",[r("li",[s._v("指定CA证书路径")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml \nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" KubeletConfiguration\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1beta1\naddress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("              \nport"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10250")]),s._v("                  # 当前kubelet的监听端口\nreadOnlyPort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10255")]),s._v("             # kubelet暴露的指标端口，一般用不上\ncgroupDriver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" cgroupfs           # 配置驱动，要和docker info中显示的驱动一致\nclusterDNS"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("                  # 这个是kubelet默认配置的内部dns地址，这个地址是预留的，以便我们后续自己部署dns服务\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),s._v("\nclusterDomain"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" cluster"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("local      # 集群的域\nfailSwapOn"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("              # 关闭使用swap\nauthentication"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("               # 配置必须通过授权才能访问k8s\n  anonymous"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    enabled"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  webhook"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    cacheTTL"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("m0s\n    enabled"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  x509"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    clientCAFile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem        # 指定"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("证书路径\nauthorization"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  mode"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Webhook\n  webhook"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    cacheAuthorizedTTL"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("m0s\n    cacheUnauthorizedTTL"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("s\nevictionHard"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  imagefs"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("available"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\n  memory"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("available"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("Mi\n  nodefs"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("available"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\n  nodefs"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("inodesFree"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("\nmaxOpenFiles"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),s._v("\nmaxPods"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br")])]),r("h4",{attrs:{id:"_5-1-2-4-bootstrap-kubeconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-4-bootstrap-kubeconfig"}},[s._v("#")]),s._v(" 5.1.2.4 bootstrap.kubeconfig")]),s._v(" "),r("p",[s._v("==.kubeconfig结尾的是连接kube-apiserver配置文件，帮要加入集群的node节点，使用这个配置文件获取证书==")]),s._v(" "),r("ul",[r("li",[s._v("指定 kubelet携带CA证书的路径")]),s._v(" "),r("li",[r("code",[s._v("指定集群中 k8s-master服务地址")])]),s._v(" "),r("li",[r("code",[s._v("指定 token值一定要和k8s-master1中token.csv配置的token值一致")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat bootstrap"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig \napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\nclusters"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    certificate"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("authority"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem       # 携带"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("的证书去请求\n    server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("                  # k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1的地址\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kubernetes\ncontexts"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" context"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kubernetes\n    user"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bootstrap\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\ncurrent"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("context"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Config\npreferences"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nusers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bootstrap\n  user"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    token"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" c47ffb939f5ca36231d9e3121a252940               # 这个token值一定要和k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1中token"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csv配置的token值一致\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br")])]),r("h3",{attrs:{id:"_5-1-3-kube-proxy服务安装相关配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-3-kube-proxy服务安装相关配置文件"}},[s._v("#")]),s._v(" 5.1.3 kube-proxy服务安装相关配置文件")]),s._v(" "),r("h4",{attrs:{id:"_1-1-3-1-kube-proxy-service-无需改动"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-1-kube-proxy-service-无需改动"}},[s._v("#")]),s._v(" 1.1.3.1 kube-proxy.service:无需改动")]),s._v(" "),r("p",[s._v("==.service结尾的是服务管理命令配置文件：无需修改==")]),s._v(" "),r("ul",[r("li",[s._v("指定 kube-proxy.conf 配置文件路径")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nDescription"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Kubernetes Proxy\nAfter"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nEnvironmentFile"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\nExecStart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("KUBE_PROXY_OPTS")]),s._v("\nRestart"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("failure\nLimitNOFILE"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nWantedBy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("user"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("target\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])]),r("h4",{attrs:{id:"_1-1-3-2-kube-proxy-conf-无需改动"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-2-kube-proxy-conf-无需改动"}},[s._v("#")]),s._v(" 1.1.3.2 kube-proxy.conf:无需改动")]),s._v(" "),r("p",[s._v("==.conf后缀的是服务主配置文件==")]),s._v(" "),r("ul",[r("li",[s._v("指定kube-proxy-config.yml配置文件位置")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \n# 日志配置\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("KUBE_PROXY_OPTS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--logtostderr=false \\\n--v=2 \\\n--log-dir=/opt/kubernetes/logs \\\n--config=/opt/kubernetes/cfg/kube-proxy-config.yml"')]),s._v("    # 指定kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml配置文件路径\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("h4",{attrs:{id:"_1-1-3-3-kube-proxy-config-yml"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-3-kube-proxy-config-yml"}},[s._v("#")]),s._v(" 1.1.3.3 kube-proxy-config.yml")]),s._v(" "),r("p",[s._v("==.yml 结尾的也是一些服务主要的配置文件：无需修改==")]),s._v(" "),r("ul",[r("li",[s._v("指定 kube-proxy.kubeconfig  文件位置")]),s._v(" "),r("li",[r("code",[s._v("指定当前注册到k8s服务的节点名称，唯一即可")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml \nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" KubeProxyConfiguration\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kubeproxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1alpha1\naddress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("                               # 监听地址\nmetricsBindAddress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10249")]),s._v("                   # 暴露端口\nclientConnection"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  kubeconfig"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig        # 客户端连接配置文件位置\nhostnameOverride"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1                            # 当前注册到k8s服务的节点名称，唯一即可\nclusterCIDR"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("                              # 集群service的段\nmode"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ipvs                                       # 使用ipvs模式进行负载均衡，比iptables负载均衡好\nipvs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  scheduler"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rr"')]),s._v("\niptables"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  masqueradeAll"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br")])]),r("h4",{attrs:{id:"_1-1-3-4-kube-proxy-kubeconfig"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-4-kube-proxy-kubeconfig"}},[s._v("#")]),s._v(" 1.1.3.4 kube-proxy.kubeconfig")]),s._v(" "),r("p",[s._v("==.kubeconfig结尾的是连接kube-apiserver配置文件==")]),s._v(" "),r("ul",[r("li",[s._v("指定 kubelet携带CA证书的路径")]),s._v(" "),r("li",[r("code",[s._v("指定集群中 k8s-master服务地址")])]),s._v(" "),r("li",[s._v("指定 kube-proxy.pem 证书路径")]),s._v(" "),r("li",[r("code",[s._v("指定 token值一定要和k8s-master1中token.csv配置的token值一致")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig \napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\nclusters"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    certificate"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("authority"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem             # 指定"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CA")]),s._v("的路径\n    server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("                       # 指定k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1服务地址\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kubernetes\ncontexts"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" context"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kubernetes\n    user"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\ncurrent"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("context"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Config\npreferences"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nusers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy\n  user"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    client"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certificate"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem         # 指定前面在kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1上为kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy生成的证书位置\n    client"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br")])]),r("h3",{attrs:{id:"_5-1-4-grep检查是否所有ip和主机名都被正确修改"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-4-grep检查是否所有ip和主机名都被正确修改"}},[s._v("#")]),s._v(" 5.1.4 grep检查是否所有ip和主机名都被正确修改")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# grep "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n/root/kubernetes/cfg/bootstrap.kubeconfig:    server: https://192.168.56.63:6443\n/root/kubernetes/cfg/kube-proxy.kubeconfig:    server: https://192.168.56.63:6443\n\n[root@k8s-node1 cfg]# grep hostname /root/kubernetes/cfg/*\n/root/kubernetes/cfg/kubelet.conf:--hostname-override=k8s-node1 \\\n/root/kubernetes/cfg/kube-proxy-config.yml:hostnameOverride: k8s-node1\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("h2",{attrs:{id:"_5-2-安装kubelet和kube-proxy"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-安装kubelet和kube-proxy"}},[s._v("#")]),s._v(" 5.2 安装kubelet和kube-proxy")]),s._v(" "),r("p",[s._v("==一定要保证/root/kubernetes/cfg/下的配置文件完成修改==")]),s._v(" "),r("h3",{attrs:{id:"_5-2-1-k8s-node1中添加证书启动kubelet和kube-proxy"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-1-k8s-node1中添加证书启动kubelet和kube-proxy"}},[s._v("#")]),s._v(" 5.2.1 k8s-node1中添加证书启动kubelet和kube-proxy")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.在 k8s-ndoe1中将kubelet配置移动到 /opt 目录下'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token regex"}},[r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("opt")]),r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# mv kubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("systemd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.在 k8s-master1中将kubelet和kube-proxy证书拷贝到192.168.56.65的/opt/kubernetes/ssl/下 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# scp ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem    root@"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".65")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.在 k8s-ndoe1中将操作，启动kubelet'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl start kubelet                                 # 启动kubelet\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl enable kubelet                                 # 启动kubelet\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tail "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INFO")]),s._v("                       # 查看kubelet启动日志\n# 可以看到日志中输出：使用引导kubeconfig生成"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),s._v("客户端证书、密钥和kubeconfig文件\nUsing bootstrap kubeconfig to generate "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TLS")]),s._v(" client cert"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key and kubeconfig file  \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br")])]),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 cfg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl start kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h3",{attrs:{id:"_5-2-2-在k8s-master1中允许给node1颁发证书"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-2-在k8s-master1中允许给node1颁发证书"}},[s._v("#")]),s._v(" 5.2.2 在k8s-master1中允许给node1颁发证书")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.自k8s-master1中允许k8s-node1颁发证书请求  '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" csr     # 查看是否有新客户端请求颁发证书\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                                                   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REQUESTOR")]),s._v("           "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CONDITION")]),s._v("\nnode"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("roupJEd8XryztUvgCtPQOEOmP1wWqU_03uz_yjBfRoM   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("m17s   kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bootstrap   Pending\n# 使用kubect certificate命令，允许这个证书加入集群中，并为其颁发证书\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl certificate approve node"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("roupJEd8XryztUvgCtPQOEOmP1wWqU_03uz_yjBfRoM\ncertificatesigningrequest"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("certificates"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("csr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("roupJEd8XryztUvgCtPQOEOmP1wWqU_03uz_yjBfRoM approved\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" node\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLES")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VERSION")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1   NotReady   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("m25s   v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.0")]),s._v("      # 可以看到状态是NotReady，因为我们还没有部署cni插件\n\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.在 k8s-node1中可以看到有错误日志产生，提示没有cni插件，但是在node1中生成了.pem和.kubeconfig文件'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 ssl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tail "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INFO")]),s._v(" \nUnable to update cni config"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" no networks found "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cni"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("net"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.1 kubelet-client-2020-12-18-04-26-54.pem是k8s-master1自动颁发的证书'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 ssl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ls "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\nkubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("54.")]),s._v("pem      # 在k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1中可以看到已经生成了一个kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("开头的证书\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.1  kubelet.kubeconfig是自动生成的连接 k8s-apiserver的配置文件'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 ssl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubeconfig \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br")])]),r("h1",{attrs:{id:"_06-k8s-node2部署kubelet、kube-proxy"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_06-k8s-node2部署kubelet、kube-proxy"}},[s._v("#")]),s._v(" 06.k8s-node2部署kubelet、kube-proxy")]),s._v(" "),r("h2",{attrs:{id:"_6-1-中仿照node1再次执行一次即可"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-中仿照node1再次执行一次即可"}},[s._v("#")]),s._v(" 6.1 中仿照node1再次执行一次即可")]),s._v(" "),r("h1",{attrs:{id:"_07-部署cni网络"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_07-部署cni网络"}},[s._v("#")]),s._v(" 07.部署CNI网络")]),s._v(" "),r("h2",{attrs:{id:"_7-1-下载cni插件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-下载cni插件"}},[s._v("#")]),s._v(" 7.1 下载cni插件")]),s._v(" "),r("ul",[r("li",[r("code",[s._v("下载地址：")]),s._v(" https://github.com/containernetworking/plugins/releases")]),s._v(" "),r("li",[r("img",{staticStyle:{width:"700px","margin-left":"20px"},attrs:{src:a(638)}})])]),s._v(" "),r("h2",{attrs:{id:"_7-2-安装cni插件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-安装cni插件"}},[s._v("#")]),s._v(" 7.2 安装cni插件")]),s._v(" "),r("h3",{attrs:{id:"_7-2-1-k8s-node1安装cni"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-1-k8s-node1安装cni"}},[s._v("#")]),s._v(" 7.2.1 k8s-node1安装cni")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# mkdir "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cni"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin          # 二进制可执行脚本路径，默认k8s会到这个路径，找二进制可执行文件，为每一个pod创建ip\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# mkdir "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cni"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("net"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d         # 生成配置信息目录\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'将文件解压到 /opt/cni/bin 文件夹下 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tar "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xvf cni"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugins"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("linux"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v0"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.2")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tgz "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("C")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cni"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n \n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'拷贝到 k8s-node2只要有k8s-kubelet就需要部署cni '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# scp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cni"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" root@"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token regex"}},[r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("opt")]),r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("h3",{attrs:{id:"_7-2-2-k8s-master1部署执行部署-kube-flannel"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-2-k8s-master1部署执行部署-kube-flannel"}},[s._v("#")]),s._v(" 7.2.2 k8s-master1部署执行部署 kube-flannel")]),s._v(" "),r("p",[s._v("==将kube-flannel.yaml上传到k8s-master1的 /root/文件夹==")]),s._v(" "),r("h4",{attrs:{id:"_7-2-2-1-kube-flannel-yaml说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-2-1-kube-flannel-yaml说明"}},[s._v("#")]),s._v(" 7.2.2.1 kube-flannel.yaml说明")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.对 kube-flannel.yaml配置文件简单说明'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml      # 主要有下面三个配置地方需要注意一下\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" apps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" DaemonSet            # "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("以DaemonSet方式部署，每一个node上都会部署一个flannel\n\n  net"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("conf"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      # "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("这个网络配置要和"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cfg"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf中配置的 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cidr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" \\ 同一网段\n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Network"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.244.0.0/16"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("     \n      "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Backend"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Type"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vxlan"')]),s._v("            # 使用vxlan网络模式\n      "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n        operator"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" In\n        values"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" amd64     # "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("只在amd64的平台部署\n          \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br")])]),r("h4",{attrs:{id:"_7-2-2-2-k8s-master1中执行部署kube-flannel命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-2-2-k8s-master1中执行部署kube-flannel命令"}},[s._v("#")]),s._v(" 7.2.2.2 k8s-master1中执行部署kube-flannel命令")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.在k8s-master1中执行部署kube-flannel命令'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml      # 执行部署 kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel命令\n# 需要到仓库中下载：lizhenliang"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flannel镜像所以需要一个比较长的时间\n# 如果实在是太慢，可以在需要加入的所有node节点，自行下载：docker pull lizhenliang"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("v0"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64\npodsecuritypolicy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("policy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("psp"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("unprivileged created\nclusterrole"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flannel created\nclusterrolebinding"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flannel created\nserviceaccount"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flannel created\nconfigmap"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cfg created\ndaemonset"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64 created\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl restart kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy    # 如果某一个节点状态问题，可以到对应node中重启 kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy组件\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("h4",{attrs:{id:"_7-2-2-3-对k8s集群状态查看，是否正常"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-2-3-对k8s集群状态查看，是否正常"}},[s._v("#")]),s._v(" 7.2.2.3 对k8s集群状态查看，是否正常")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.由于需要到网上下载lizhenliang/flannel镜像，所以需要耗费几分钟时间，node节点状态才能正常  '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                          "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("                  "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ptsbg   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Init"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("ImagePullBackOff   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("m58s\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("q2bt9   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Init"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("m58s\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl describe pod kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ptsbg "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl logs kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ptsbg "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system\nError "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("server")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Forbidden"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("Forbidden")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" verb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("get"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" resource"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nodes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" subresource"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" pods"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ptsbg"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'经过十分钟的等待，终于两个node节点变成了Running状态 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system  \n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                          "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ptsbg   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v("m\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("q2bt9   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v("m\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" node    # 可以看到两个node节点现在工作都正常了\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLES")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VERSION")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1   Ready    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("h4m   v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.0")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2   Ready    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("h2m   v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16.0")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tail "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INFO")]),s._v("    # 在k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1中查看，kubelet日志也没有报错了\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br")])]),r("h2",{attrs:{id:"_7-3-授权apiserver访问kubelet"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-授权apiserver访问kubelet"}},[s._v("#")]),s._v(" 7.3 授权apiserver访问kubelet")]),s._v(" "),r("ul",[r("li",[r("p",[r("code",[s._v("为提供安全性，kubelet禁止匿名访问，必须授权才可以。")])])]),s._v(" "),r("li",[r("p",[s._v("在k8s-master1中进行授权，可以访问node的日志，pod的日志")])])]),s._v(" "),r("h3",{attrs:{id:"_7-3-1-apiserver-to-kubelet-rbac-yaml文件说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-1-apiserver-to-kubelet-rbac-yaml文件说明"}},[s._v("#")]),s._v(" 7.3.1 apiserver-to-kubelet-rbac.yaml文件说明")]),s._v(" "),r("p",[s._v("==将apiserver-to-kubelet-rbac.yaml文件拖入到k8s-master1的/root/路径下==")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat apiserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("to"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml \napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ClusterRole\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  annotations"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("autoupdate"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("\n  labels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    kubernetes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bootstrapping"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rbac"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("defaults\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" system"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("to"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kubelet\nrules"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" apiGroups"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    resources"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" nodes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("proxy\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" nodes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("stats\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" nodes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" nodes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("spec\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" nodes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("metrics\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" pods"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log\n    verbs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ClusterRoleBinding\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" system"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver\n  namespace"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\nroleRef"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  apiGroup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io\n  kind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ClusterRole\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" system"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("to"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kubelet\nsubjects"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" apiGroup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io\n    kind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" User\n    name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kubernetes\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br")])]),r("h3",{attrs:{id:"_7-3-2-在k8s-master1中授权apiserver访问kubelet"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-2-在k8s-master1中授权apiserver访问kubelet"}},[s._v("#")]),s._v(" 7.3.2 在k8s-master1中授权apiserver访问kubelet")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("' 在k8s-master1中执行授权命令 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f apiserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("to"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml \nclusterrole"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("to"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kubelet created\nclusterrolebinding"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver created\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'可以看到不再报错 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl logs kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ptsbg "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system     # 可以看到不再报错\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'查看集群中pod详细信息  '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o wide\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                  "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NOMINATED")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READINESS")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GATES")]),s._v("\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ptsbg   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("m   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".65")]),s._v("   k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("amd64"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("q2bt9   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("m   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),s._v("   k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("h2",{attrs:{id:"_7-4-在k8s-master1中创建一个pod测试集群是否成功"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-在k8s-master1中创建一个pod测试集群是否成功"}},[s._v("#")]),s._v(" 7.4 在k8s-master1中创建一个pod测试集群是否成功")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl create deployment web "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\ndeployment"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web created\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o wide       # 可以看到这个pod实际部署到了 k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 节点上\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("             "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("       "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NOMINATED")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READINESS")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GATES")]),s._v("\nweb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d86c95cc9"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("wk82   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   ContainerCreating   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v("s   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl describe pod web"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d86c95cc9"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("wk82           # 查看当前pod详细信息\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl expose deployment web "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("type"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort\nservice"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web exposed\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("svc\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("              "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\npod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d86c95cc9"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("wk82   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     ContainerCreating   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("m59s\n\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                 "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TYPE")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLUSTER")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EXTERNAL")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORT")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("S")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\nservice"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes     ClusterIP    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("h\nservice"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web          NodePort    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".221")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30464")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v("s\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br")])]),r("ul",[r("li",[s._v("测试访问")])]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("http://192.168.56.65:30464/\nhttp://192.168.56.66:30464/\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("ul",[r("li",[r("img",{staticStyle:{width:"800px","margin-left":"20px"},attrs:{src:a(639)}})])]),s._v(" "),r("h1",{attrs:{id:"_08-此时使用三台机器部署单mster集群完成"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_08-此时使用三台机器部署单mster集群完成"}},[s._v("#")]),s._v(" 08.此时使用三台机器部署单mster集群完成")]),s._v(" "),r("h2",{attrs:{id:"_8-1-对于单maser中服务管理命令说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-对于单maser中服务管理命令说明"}},[s._v("#")]),s._v(" 8.1 对于单maser中服务管理命令说明")]),s._v(" "),r("ul",[r("li",[s._v("k8s-master1中服务管理命令(192.168.56.63)")])]),s._v(" "),r("div",{staticClass:"language-powershell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-powershell"}},[r("code",[s._v("systemctl "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),s._v(" etcd\nsystemctl "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),s._v(" kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver\nsystemctl "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),s._v(" kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager\nsystemctl "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),s._v(" kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler\n\nsystemctl enable etcd\nsystemctl enable kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver\nsystemctl enable kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager\nsystemctl enable kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br")])]),r("ul",[r("li",[s._v("k8s-node1（192.168.56.65）和k8s-node2（192.168.56.66）中服务管理命令")])]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("systemctl start etcd\nsystemctl start kubelet\nsystemctl start kube-proxy\n\nsystemctl "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" etcd\nsystemctl "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet\nsystemctl "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kube-proxy\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);