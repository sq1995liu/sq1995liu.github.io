(window.webpackJsonp=window.webpackJsonp||[]).push([[281],{965:function(s,a,t){"use strict";t.r(a);var e=t(21),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ansible常用模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ansible常用模块"}},[s._v("#")]),s._v(" ansible常用模块")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("执行shell命令（command和shell）")])]),s._v(" "),t("li",[t("strong",[s._v("文件传输（copy和file）")])]),s._v(" "),t("li",[t("strong",[s._v("管理软件包（yum）")])]),s._v(" "),t("li",[t("strong",[s._v("用户和组（user）")])]),s._v(" "),t("li",[t("strong",[s._v("从源代码管理系统部署（git）")])]),s._v(" "),t("li",[t("strong",[s._v("管理服务（service）")])]),s._v(" "),t("li",[t("strong",[s._v("收集目标主机信息（setup）")])])]),s._v(" "),t("h2",{attrs:{id:"_01-执行shell命令-command和shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_01-执行shell命令-command和shell"}},[s._v("#")]),s._v(" 01.执行shell命令(command和shell)")]),s._v(" "),t("h3",{attrs:{id:"_1-1-command"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-command"}},[s._v("#")]),s._v(" 1.1 Command")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("在Ad-Hoc常用选项中介绍到 -m 用来指定运行的模块，没有指定模块 时，默认使用的是command模块")])]),s._v(" "),t("li",[t("p",[s._v("命令说明：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("-a")]),s._v("：在常用选贡中介绍到，该选项用来为模块提供参数，这里为command模块提供一条命令参数；")]),s._v(" "),t("li",[s._v('"'),t("code",[s._v("df -hl")]),s._v('" ：在远程主机上执行的命令；')]),s._v(" "),t("li",[t("code",[s._v("webservers")]),s._v("：主机清单hosts上配置的主机组，包含192.168.56.66和192.168.56.65。")])])])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"df -hl"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_1-2-shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-shell"}},[s._v("#")]),s._v(" 1.2 Shell")]),s._v(" "),t("ul",[t("li",[s._v("用来在远程主机上执行命令，使用-m 选项指定使用shell模块")]),s._v(" "),t("li",[s._v("Command与Shell比较\n"),t("ul",[t("li",[s._v("command 和 shell 模块都可以在远程主机上执行命令")]),s._v(" "),t("li",[s._v("但是command不支持变量和管道符操作，所以当需要使用到变量和管道符时需要使用shell模块")])])])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m shell "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"ifconfig | grep '192.168.56'\"")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CHANGED")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("\n        inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),s._v("  netmask "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".255")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("  broadcast "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".255")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".65")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CHANGED")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("\n        inet "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".65")]),s._v("  netmask "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".255")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("  broadcast "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".255")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("5.2")]),s._v(" "),t("h2",{attrs:{id:"_02-文件传输（copy和file）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_02-文件传输（copy和file）"}},[s._v("#")]),s._v(" 02.文件传输（copy和file）")]),s._v(" "),t("p",[s._v("https://docs.ansible.com/ansible/latest/user_guide/intro_adhoc.html")]),s._v(" "),t("h3",{attrs:{id:"_2-1-copy模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-copy模块"}},[s._v("#")]),s._v(" 2.1 copy模块")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("copy")]),s._v("：文件传输模块，可以将文件并行拷贝到多台主机上")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# touch file_test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("txt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m copy "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src=/root/file_test.txt dest=/tmp/file_test.txt"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("使用copy模块传输文件时，可以通过参数设置文件属主、属组和权限")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m copy "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src=/root/file_test.txt dest=/tmp/ owner=root group=root mode=600"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_2-2-file模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-file模块"}},[s._v("#")]),s._v(" 2.2 file模块")]),s._v(" "),t("ul",[t("li",[s._v("使用file模块可以创建文件和更改文件的所有和权限")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dest=/tmp/file_test.txt mode=666"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".65")]),s._v("\n# 修改远程文件权限为："),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v("；\n# "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("l 指定运行目标主机（过滤），从webservers主机组中找出满足过滤条件的主机来执行远程操作。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("使用file模块创建目录")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("# 创建文件夹\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dest=/tmp/dir_test owner=root state=directory"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("使用file模块删除文件")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("# 创建文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dest=/tmp/t1.txt owner=root state=touch"')]),s._v("\n# 删除文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dest=/tmp/file_test.txt state=absent"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"_03-管理软件包（yum）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_03-管理软件包（yum）"}},[s._v("#")]),s._v(" 03.管理软件包（yum）")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Ansible 提供了yum和apt模块，通过这些模块可以很方便在系统上安装软件包。")])]),s._v(" "),t("li",[t("p",[s._v("项目中使用的是Centos系统，所以可以使用yum模块来安装软件包")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("命令执行说明：")])]),s._v(" "),t("ul",[t("li",[s._v("使用yum模块来安装软件包；")]),s._v(" "),t("li",[s._v("name：用来指定安装的软件包名称；")]),s._v(" "),t("li",[s._v("state：指定安装的动作（present，installed，latest，absent，removed）")])])])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("# 安装\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m yum "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=tcpdump state=latest"')]),s._v("\n# 卸载\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m yum "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=tcpdump state=absent"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"_04-用户和组（user）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_04-用户和组（user）"}},[s._v("#")]),s._v(" 04.用户和组（user）")]),s._v(" "),t("ul",[t("li",[s._v("在所有服务器中创建test用户，若已存在，不进行任何操作")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible all "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=test'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("在所有服务器中删除test用户，但不删除此用户的家目录")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible all "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=test state=absent'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("在所有服务器中删除test用户，且删除此用户的家目录")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible all "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=test state=absent remove=yes'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("指定所有服务器中test用户的基本组为admin(需提前存在)，不指定时默认与用户名一样")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible all "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=test group=admin'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("指定所有服务器中test用户的附加组为root和admin")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible all "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=test groups=root,admin append=yes'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("指定所有服务器中test用户过期时间是2020-05-20")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# date "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("s            #获取对应日期的unix时间戳\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1621440000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible all "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=test expires=1621440000'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("修改所有服务器中test用户的密码为'123455'")])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# python\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" crypt\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>>")]),s._v(" crypt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("crypt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123455'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$6$B0zo/bCGaUmqFKx8$apGEf9i1Yd4/PE.bhL7P86T6FDir45jE5DQ549CjG3SoWtfPmAQSCDkz2Wt5kXppAlhbTLqOclg45yOz7YH9K/'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("exit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible all "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=test password=\"$6$B0zo/bCGaUmqFKx8$apGEf9i1Yd4/PE.bhL7P86T6FDir45jE5DQ549CjG3SoWtfPmAQSCDkz2Wt5kXppAlhbTLqOclg45yOz7YH9K/\"'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v('为所有服务器中test用户生成ssh密钥对，生成在/opt目录下，私钥名id_rsa_test，注释信息"test rsa"，私钥密码123455')])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible all "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=test generate_ssh_key=yes ssh_key_file=/opt/id_rsa_test ssh_key_comment=\"test rsa\" ssh_key_passphrase=123455'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_05-从源代码管理系统部署（git）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_05-从源代码管理系统部署（git）"}},[s._v("#")]),s._v(" 05.从源代码管理系统部署（git）")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("# 拉取ansible代码\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m git "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"repo=https://github.com/ansible/ansible.git dest=/tmp/ansible"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u root\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"_06-管理服务（service）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_06-管理服务（service）"}},[s._v("#")]),s._v(" 06.管理服务（service）")]),s._v(" "),t("ul",[t("li",[s._v("主要是管理服务：启动服务、停止服务")]),s._v(" "),t("li",[s._v("几种服务： "),t("code",[s._v("started")]),s._v(" 、 "),t("code",[s._v("restarted")]),s._v(" 、 "),t("code",[s._v("stopped")])])]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[s._v("# 安装 memcached\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m yum "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=memcached state=latest"')]),s._v("\n# 启动 memcached\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m service "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=memcached state=started"')]),s._v("\n# 设置ansible开机自启动\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m service "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name=memcached enabled=true"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"_07-收集目标主机信息（setup）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_07-收集目标主机信息（setup）"}},[s._v("#")]),s._v(" 07.收集目标主机信息（setup）")]),s._v(" "),t("div",{staticClass:"language-javascript line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m setup                                # 获取主机的信息\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m setup "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter=ansible_nodename"')]),s._v("            # 获取集群名称\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m setup "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter=ansible_all_ipv4_addresses"')]),s._v("     # 获取ipv4地址\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m setup "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter=ansible_memory_mb"')]),s._v("           # 获取主机内存\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ansible webservers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m setup "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter=*mb"')]),s._v('          "           # 通过通配符实现模糊匹配，比如以”mb”关键字结尾的信息\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("其他常用信息列出如下")])]),s._v(" "),t("blockquote",[t("p",[s._v("ansible_all_ipv4_addresses："),t("code",[s._v("仅显示ipv4的信息")]),s._v("。\nansible_devices："),t("code",[s._v("仅显示磁盘设备信息")]),s._v("。\nansible_distribution："),t("code",[s._v("显示是什么系统，例：centos,suse等")]),s._v("\nansible_distribution_major_version："),t("code",[s._v("显示是系统主版本")]),s._v("\nansible_distribution_version："),t("code",[s._v("仅显示系统版本")]),s._v("\nansible_machine："),t("code",[s._v("显示系统类型，例：32位，还是64位")]),s._v("\nansible_eth0："),t("code",[s._v("仅显示eth0的信息")]),s._v("\nansible_hostname："),t("code",[s._v("仅显示主机名")]),s._v("\nansible_kernel："),t("code",[s._v("仅显示内核版本")]),s._v("\nansible_lvm："),t("code",[s._v("显示lvm相关信息")]),s._v("\nansible_memtotal_mb："),t("code",[s._v("显示系统总内存")]),s._v("\nansible_memfree_mb："),t("code",[s._v("显示可用系统内存")]),s._v("\nansible_memory_mb："),t("code",[s._v("详细显示内存情况")]),s._v("\nansible_swaptotal_mb："),t("code",[s._v("显示总的swap内存")]),s._v("\nansible_swapfree_mb："),t("code",[s._v("显示swap内存的可用内存")]),s._v("\nansible_mounts："),t("code",[s._v("显示系统磁盘挂载情况")]),s._v("\nansible_processor："),t("code",[s._v("显示cpu个数(具体显示每个cpu的型号)")]),s._v("\nansible_processor_vcpus："),t("code",[s._v("显示cpu个数(只显示总的个数)")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);