(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{665:function(s,a,t){s.exports=t.p+"assets/img/image-20210129152737475.38ac5216.png"},666:function(s,a,t){s.exports=t.p+"assets/img/image-20210129152849319.36d4d9b7.png"},667:function(s,a,t){s.exports=t.p+"assets/img/image-20210129193120710.0b568ef2.png"},668:function(s,a,t){s.exports=t.p+"assets/img/image-20210129195115834.d44d0055.png"},669:function(s,a,t){s.exports=t.p+"assets/img/image-20210130194139136.93b6a1ad.png"},670:function(s,a,t){s.exports=t.p+"assets/img/image-20210130215040375.3946854d.png"},998:function(s,a,t){"use strict";t.r(a);var r=t(21),n=Object(r.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h1",{attrs:{id:"_01-在k8s平台部署项目流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_01-在k8s平台部署项目流程"}},[s._v("#")]),s._v(" 01.在k8s平台部署项目流程")]),s._v(" "),r("h2",{attrs:{id:"_1-1-容器交付流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-容器交付流程"}},[s._v("#")]),s._v(" 1.1 容器交付流程")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"700px","margin-left":"50px"},attrs:{src:t(665)}})]),s._v(" "),r("h2",{attrs:{id:"_1-2-在k8s平台部署项目流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-在k8s平台部署项目流程"}},[s._v("#")]),s._v(" 1.2 在K8s平台部署项目流程")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"700px","margin-left":"50px"},attrs:{src:t(666)}})]),s._v(" "),r("h2",{attrs:{id:"_1-3-项目熟悉"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-项目熟悉"}},[s._v("#")]),s._v(" 1.3 项目熟悉")]),s._v(" "),r("ul",[r("li",[s._v("1、项目代码构成（有哪些文件）\n"),r("ul",[r("li",[s._v("配置文件在哪里（mysql地址、redis地址）")])])]),s._v(" "),r("li",[s._v("2、依赖服务（MySQL、Redis、rabbitMQ）")]),s._v(" "),r("li",[s._v("3、项目提供服务端口")]),s._v(" "),r("li",[s._v("4、文件持久化（比如上传文件）")])]),s._v(" "),r("h1",{attrs:{id:"_02-安装harbor"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_02-安装harbor"}},[s._v("#")]),s._v(" 02.安装Harbor")]),s._v(" "),r("h2",{attrs:{id:"_2-1-安装docker"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装docker"}},[s._v("#")]),s._v(" 2.1 安装Docker")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  yum "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install wget\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  wget https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mirrors"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ce"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("linux"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("centos"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ce"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("O")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repos"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ce"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  yum "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ce\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  systemctl enable docker "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl start docker\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("ul",[r("li",[s._v("配置镜像下载加速器：")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  cat "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daemon"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EOF")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://b9pmyelo.mirror.aliyuncs.com"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EOF")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  systemctl restart docker\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  docker info\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("h2",{attrs:{id:"_2-2-安装docker-compose"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-安装docker-compose"}},[s._v("#")]),s._v(" 2.2 安装docker compose")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# 安装docker compose\ncurl "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("L")]),s._v(" https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("github"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("compose"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("releases"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("download"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.24")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token template-string"}},[r("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("uname -s")]),r("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token template-string"}},[r("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("uname -m")]),r("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose\nchmod "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("x "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose\ndocker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("version  # 测试docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose是否安装好\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("ul",[r("li",[s._v("开启Linux系统的IP转发功能")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'开启Linux系统的IP转发功能 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 出于安全考虑，Linux系统默认是禁止数据包转发的\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 所谓转发即当主机拥有多于一块的网卡时，将收到的数据包转发给其他网卡\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node4 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sysctl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf \nnet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ip_forward"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node4 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl restart network\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node4 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# sysctl net"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ip_forward   # 输出为"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("时则证明是成功的\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("h2",{attrs:{id:"_2-3-安装harbor"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-安装harbor"}},[s._v("#")]),s._v(" 2.3 安装Harbor")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'安装Harbor镜像仓库'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、下载离线安装包\nhttps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("github"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("goharbor"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("harbor"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("releases\n\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、解压并配置访问地址"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tar zxvf harbor"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("offline"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("installer"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tgz \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 harbor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd harbor\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 harbor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vi harbor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\nhostname "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),s._v("\nharbor_admin_password "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Harbor12345\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("'\n\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、准备配置\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 harbor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("prepare\n\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("、导入镜像并启动\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 harbor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("install"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh\n\n# "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("、查看容器状态\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 harbor"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("compose ps\n\n安装完成后可以登录Harbor：http"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),s._v("\n用户名：admin\n密码：Harbor12345\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br")])]),r("ul",[r("li",[s._v("新建一个项目")])]),s._v(" "),r("p",[r("img",{staticStyle:{width:"500px","margin-left":"30px"},attrs:{src:t(667)}})]),s._v(" "),r("h1",{attrs:{id:"_03-java应用部署"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_03-java应用部署"}},[s._v("#")]),s._v(" 03.Java应用部署")]),s._v(" "),r("h2",{attrs:{id:"_3-1-拉取代码编译"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-拉取代码编译"}},[s._v("#")]),s._v(" 3.1 拉取代码编译")]),s._v(" "),r("ul",[r("li",[s._v("1、拉取代码编译，构建一个可以部署的包")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# yum install java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("openjdk maven git "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# git clone https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("github"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lizhenliang"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tomcat"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo\n# 需要切换到 tomcat"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo 文件夹\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# mvn clean "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Dmaven"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("test"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("skip"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("               # 代码编译构建（生成可部署包 target"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xxx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("war）\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# unzip target"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*.war -d target/ROOT                     # 解压构建文件\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("h2",{attrs:{id:"_3-2-制作镜像推送到镜像仓库"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-制作镜像推送到镜像仓库"}},[s._v("#")]),s._v(" 3.2 制作镜像推送到镜像仓库")]),s._v(" "),r("ul",[r("li",[r("code",[s._v("1）制作镜像")]),s._v(" "),r("ul",[r("li",[s._v("1、基础镜像：centos、ubuntu")]),s._v(" "),r("li",[s._v("2、环境镜像：jdk、nginx")]),s._v(" "),r("li",[s._v("3、项目镜像：dashboard（自己写的项目打包成镜像）")])])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd tomcat"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("     # 在项目根路径中添加一个Dockerfile用来构建项目镜像\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim Dockerfile\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FROM")]),s._v(" tomcat \n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LABEL")]),s._v(" maintainer zhangsan\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RUN")]),s._v(" rm "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rf "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tomcat"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("webapps"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nADD target/ROOT /usr/local/tomcat/webapps/ROOT\n")])])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("ul",[r("li",[r("code",[s._v("2）构建镜像")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# docker build "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("             # 构建镜像\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# docker run "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo       # 先使用镜像简单测试\nhttp"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".61")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v("        # 测试页面中访问\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("ul",[r("li",[r("code",[s._v("3）登录harber仓库")]),s._v("配置可信任（如果仓库是HTTPS访问不用配置）\n"),r("ul",[r("li",[s._v("==因为我们这里的harbor没有配置https，所以，所有docker都要添加对harbor的信任==")])])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vi "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daemon"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://b9pmyelo.mirror.aliyuncs.com"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.56.66"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# docker login "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),s._v("\n# 用户名： admin\n# 密  码： Harbor12345\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("ul",[r("li",[s._v("4）把镜像推送到镜像仓库")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  docker tag java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("v1      # 给刚刚的java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo镜像打一个标签\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  docker push  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("v1           # 推送到镜像仓库\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master tomcat"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# docker run "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8889")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo2 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("v1    # 测试部署\nhttp"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".61")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8889")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("    # 测试访问\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("h2",{attrs:{id:"_3-3-使用控制器部署"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-使用控制器部署"}},[s._v("#")]),s._v(" 3.3 使用控制器部署")]),s._v(" "),r("h3",{attrs:{id:"_3-3-1-添加k8s集群的harbor认证"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-添加k8s集群的harbor认证"}},[s._v("#")]),s._v(" 3.3.1 添加k8s集群的harbor认证")]),s._v(" "),r("ul",[r("li",[s._v("在k8s-master中添加 harbor认证的用户名密码")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# 将镜像仓库认证凭据保存在K8s Secret中"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("k8s中会保存harbor的用户名和密码，k8s在yaml指定这个secret凭据即可\nkubectl create secret docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("registry registry"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("username"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("password"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Harbor12345 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),s._v("\n# 下面在deployment"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml中使用这个认证凭据\nimagePullSecrets"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" registry"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("ul",[r("li",[s._v("在所有k8s的node节点中添加harbor信任")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vi "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daemon"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://b9pmyelo.mirror.aliyuncs.com"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.56.66"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl restart docker\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("h3",{attrs:{id:"_3-3-2-deplyment部署java-demo"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-deplyment部署java-demo"}},[s._v("#")]),s._v(" 3.3.2 deplyment部署java-demo")]),s._v(" "),r("ul",[r("li",[s._v("在官网搜索deployment：https://kubernetes.io/docs/home/")]),s._v(" "),r("li",[s._v("1）"),r("code",[s._v("在官网找到deployment配置案例")]),s._v("（搜索：deployment）")])]),s._v(" "),r("p",[r("img",{staticStyle:{width:"900px","margin-left":"50px"},attrs:{src:t(668)}})]),s._v(" "),r("ul",[r("li",[s._v("2）"),r("code",[s._v("在官网找到 资源限额 配置案例")]),s._v("（搜索：redinessProbe）")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim deployment"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" apps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1          # 版本\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Deployment            # 资源类型\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("                 # 元数据\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo           # 名字修改成合适的（要修改）\n  labels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("                # 标签是标记deployment对象的，用不到，这里随便改一下即可\n    app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo\nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  replicas"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("              # 指定副本数（根据项目需要指定运行数量）\n  selector"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("               #### 标签选择器非常重要，控制器关联pod时使用的选择器（至少配置项目两个标签）\n    matchLabels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      project"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" www          # 第一个，project是声明你的项目的，这里随便取了一个标签（www）\n      app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo           # 第二个，具体的应用名称，这里就取 java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo\n  template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    metadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      labels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("            #### 这里是pod的标签 "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("，必须要和上面保持一一对应")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("deployment会根据这两个标签来选择合适的pod"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        project"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" www\n        app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo\n    spec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("                #### 这里指的容器相关的配置，部署那个镜像\n      imagePullSecrets"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("                       ### 这里添加harbor拉取镜像的认证配置\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" registry"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth                    ### registry"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth 就是上面创建凭据的名称（使用上面的harbor用户名密码拉取）\n      containers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" web                            # 把这个容器的名字取名为 web\n        image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".66")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("v1       # 这里写镜像仓库的地址\n        ports"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" containerPort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("                   # 项目运行的端口默认是 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n        # "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("）配置资源限额（官方搜索：resources）\n        resources"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("                           # 配置资源限额\n          requests"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            cpu"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v("\n            memory"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("Mi\n          limits"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            cpu"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n            memory"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("Gi\n        # "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）存活健康检查（官方搜索：livenessProbe）\n        livenessProbe"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          httpGet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            path"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("                     # 检查路径是项目 根路径\n            port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("                   # 这里是Tomcat，所以端口是 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("端口\n          initialDelaySeconds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("            # 容器启动后"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("秒后进行第一处健康检查\n          periodSeconds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("                # 再隔"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("秒进行第二次健康检查\n        # "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("）就绪健康检查（官方搜索：readinessProbe）\n        readinessProbe"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          httpGet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            path"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n            port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n          initialDelaySeconds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("            # 容器启动后"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("秒后进行第一处健康检查\n        # "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("）mountPath配置挂载配置文件到容器中的目录\n        # 默认项目的配置文件就在："),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tomcat"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("webapps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROOT")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("WEB")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INF")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("classes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("application"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml 路径下\n        volumeMounts"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" config\n          mountPath"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/tomcat/webapps/ROOT/WEB-INF/classes/application.yml"')]),s._v("\n          subPath"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" application"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml              # 使用subPath，解决挂载文件后覆盖文件夹其他文件问题\n      # "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("）配置configmap（使用卷挂载到容器指定路径下）\n      volumes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" config\n        configMap"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config         # 引用 刚刚 configmap中创建的名称\n          items"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"application.yml"')]),s._v("        # 这个key是创建configmap时指定的key\n            path"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"application.yml"')]),s._v("       # 挂载到容器中显示的文件名\n \n \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f deployment"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml                 # 部署 deployment（现部署configMap ）\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f deployment"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml                 # 卸载 deployment\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods                             # 查看节点状态\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl describe pod java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("b8bbcd587"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("nmml        # 查找具体pod报错日志\n\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br"),r("span",{staticClass:"line-number"},[s._v("36")]),r("br"),r("span",{staticClass:"line-number"},[s._v("37")]),r("br"),r("span",{staticClass:"line-number"},[s._v("38")]),r("br"),r("span",{staticClass:"line-number"},[s._v("39")]),r("br"),r("span",{staticClass:"line-number"},[s._v("40")]),r("br"),r("span",{staticClass:"line-number"},[s._v("41")]),r("br"),r("span",{staticClass:"line-number"},[s._v("42")]),r("br"),r("span",{staticClass:"line-number"},[s._v("43")]),r("br"),r("span",{staticClass:"line-number"},[s._v("44")]),r("br"),r("span",{staticClass:"line-number"},[s._v("45")]),r("br"),r("span",{staticClass:"line-number"},[s._v("46")]),r("br"),r("span",{staticClass:"line-number"},[s._v("47")]),r("br"),r("span",{staticClass:"line-number"},[s._v("48")]),r("br"),r("span",{staticClass:"line-number"},[s._v("49")]),r("br"),r("span",{staticClass:"line-number"},[s._v("50")]),r("br"),r("span",{staticClass:"line-number"},[s._v("51")]),r("br"),r("span",{staticClass:"line-number"},[s._v("52")]),r("br"),r("span",{staticClass:"line-number"},[s._v("53")]),r("br"),r("span",{staticClass:"line-number"},[s._v("54")]),r("br"),r("span",{staticClass:"line-number"},[s._v("55")]),r("br"),r("span",{staticClass:"line-number"},[s._v("56")]),r("br"),r("span",{staticClass:"line-number"},[s._v("57")]),r("br"),r("span",{staticClass:"line-number"},[s._v("58")]),r("br"),r("span",{staticClass:"line-number"},[s._v("59")]),r("br"),r("span",{staticClass:"line-number"},[s._v("60")]),r("br"),r("span",{staticClass:"line-number"},[s._v("61")]),r("br"),r("span",{staticClass:"line-number"},[s._v("62")]),r("br"),r("span",{staticClass:"line-number"},[s._v("63")]),r("br"),r("span",{staticClass:"line-number"},[s._v("64")]),r("br"),r("span",{staticClass:"line-number"},[s._v("65")]),r("br"),r("span",{staticClass:"line-number"},[s._v("66")]),r("br"),r("span",{staticClass:"line-number"},[s._v("67")]),r("br"),r("span",{staticClass:"line-number"},[s._v("68")]),r("br"),r("span",{staticClass:"line-number"},[s._v("69")]),r("br")])]),r("ul",[r("li",[s._v("检查挂载是否成功")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# 确定配置文件是否成功挂载\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl exec "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("it java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("dbfd444f9"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("86")]),s._v("d66 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" bash\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cd "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tomcat"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("webapps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROOT")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("WEB")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INF")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("classes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("ul",[r("li",[s._v("configMap配置：保存项目配置文件")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  vim configmap"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1            # 版本\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ConfigMap            # 资源类型\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("                # 源数据\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config      # 名字\ndata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    # 指定一个key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("上面要引用这个key\n    application"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n        server"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n        spring"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          datasource"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            url"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" jdbc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("localhost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("characterEncoding"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n            username"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" root\n            password"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456789")]),s._v("\n            driver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" com"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mysql"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jdbc"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Driver\n          freemarker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            allow"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("request"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("override"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n            cache"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n            check"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("location"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n            charset"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UTF")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n            content"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("type"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" text"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" charset"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n            expose"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("request"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("attributes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n            expose"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("session"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("attributes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n            expose"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("spring"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("macro"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("helpers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n            suffix"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ftl\n            template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("loader"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("path"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" classpath"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token regex"}},[r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("templates")]),r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f configmap"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml   # 创建configmap\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br")])]),r("h2",{attrs:{id:"_3-4-创建service关联到对应pod"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-创建service关联到对应pod"}},[s._v("#")]),s._v(" 3.4 创建Service关联到对应pod")]),s._v(" "),r("div",{staticClass:"language-yaml line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-yaml"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master ~"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim service.yaml")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo \n"),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("       "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里的标签选择器一定要和deployment中配置的一致")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("project")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" www\n    "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo\n  "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n      "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master ~"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f service.yaml ")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master ~"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get ep                    # 可以看到已经关联到了对应的pod")]),s._v("\nNAME            ENDPOINTS                                      AGE\njava"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo       10.244.169.155"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10.244.169.156"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("10.244.36.88"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8080      24s\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br")])]),r("h2",{attrs:{id:"_3-5-创建ingress暴露端口"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-创建ingress暴露端口"}},[s._v("#")]),s._v(" 3.5 创建Ingress暴露端口")]),s._v(" "),r("div",{staticClass:"language-yaml line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-yaml"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master ~"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim ingress.yaml")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.k8s.io/v1\n"),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ingress\n"),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo\n"),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" java.example.com\n    "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n        "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pathType")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Prefix\n        "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo\n            "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),r("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br")])]),r("ul",[r("li",[s._v("部署ingress")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f ingress"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml        # 部署\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" ingress\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLASS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOSTS")]),s._v("              "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ADDRESS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\njava"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   java"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com             "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("s\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("svc "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nginx "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("o wide     # 查看哪些pod节点添加了Ingress\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                                 "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NOMINATED")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READINESS")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GATES")]),s._v("\npod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f9wvw   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("h   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".62")]),s._v("   k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\npod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ingress"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("wpf6w   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("h   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),s._v("   k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("ul",[r("li",[r("p",[s._v("添加域名解析（两个节点都可以）")]),s._v(" "),r("ul",[r("li",[s._v("修改 C:\\Windows\\System32\\drivers\\etc\\hosts 记录")]),s._v(" "),r("li",[s._v("添加： 192.168.56.62  java.example.com")]),s._v(" "),r("li",[s._v("因为刚刚创建的 Ingress被部署到了 192.168.56.62  机器中，所以这里使用域名解析也必须是他")])])])]),s._v(" "),r("h2",{attrs:{id:"_3-6-k8s部署一个mysql数据库-不用部署"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-k8s部署一个mysql数据库-不用部署"}},[s._v("#")]),s._v(" 3.6 k8s部署一个mysql数据库(不用部署)")]),s._v(" "),r("ul",[r("li",[s._v("数据库还是推荐传统方式部署")]),s._v(" "),r("li",[s._v("因为数据库消耗io，如果部署外k8s中，会增加物理机的io开销")]),s._v(" "),r("li",[s._v("另外就是安全性也是问题")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim mysql"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Secret\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("db\n  namespace"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\ntype"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Opaque\ndata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("password"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MTIzNDU2"')]),s._v("    # 这里是base64保存的mysql密码，实际是"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n  mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("password"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MTIzNDU2"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" apps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Deployment\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("db\n  namespace"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  selector"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    matchLabels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      project"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" www\n      app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" mysql\n  template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    metadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      labels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        project"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" www\n        app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" mysql\n    spec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      containers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" db\n        image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".30")]),s._v("\n        resources"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("        # "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("）配置资源限额\n          requests"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            cpu"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("m\n            memory"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("Mi\n          limits"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            cpu"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("m\n            memory"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("512")]),s._v("Mi\n        env"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("               # "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）配置环境变量\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MYSQL_ROOT_PASSWORD")]),s._v("\n          valueFrom"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            secretKeyRef"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n              name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("db\n              key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("root"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("password\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MYSQL_PASSWORD")]),s._v("\n          valueFrom"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            secretKeyRef"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n              name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("db\n              key"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("password\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MYSQL_USER")]),s._v("\n          value"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"aliang"')]),s._v("        # 创建一个普通用户 aliang\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MYSQL_DATABASE")]),s._v("      # 创建一个数据库名字为 k8s\n          value"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k8s"')]),s._v("\n        ports"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" mysql\n          containerPort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("      # 监听端口\n        livenessProbe"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("            # 健康检查，使用 ping命令\n          exec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            command"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" sh\n            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c\n            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysqladmin ping -u root -p${MYSQL_ROOT_PASSWORD}"')]),s._v("\n          initialDelaySeconds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n          periodSeconds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n        readinessProbe"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          exec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            command"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" sh\n            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c\n            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysqladmin ping -u root -p${MYSQL_ROOT_PASSWORD}"')]),s._v("\n          initialDelaySeconds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n          periodSeconds"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n        volumeMounts"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("             # 挂载的数据卷\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" data\n          mountPath"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql\n        \n      volumes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" data\n        persistentVolumeClaim"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n          claimName"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("db\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PersistentVolumeClaim\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("db\n  namespace"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  storageClassName"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"managed-nfs-storage"')]),s._v("\n  accessModes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ReadWriteOnce"')]),s._v("\n  resources"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    requests"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      storage"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8Gi"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Service\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" java"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("db\n  namespace"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  type"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ClusterIP\n  ports"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" mysql\n    port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n    targetPort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" mysql\n  selector"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    project"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" www\n    app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" mysql\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f mysql"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br"),r("span",{staticClass:"line-number"},[s._v("36")]),r("br"),r("span",{staticClass:"line-number"},[s._v("37")]),r("br"),r("span",{staticClass:"line-number"},[s._v("38")]),r("br"),r("span",{staticClass:"line-number"},[s._v("39")]),r("br"),r("span",{staticClass:"line-number"},[s._v("40")]),r("br"),r("span",{staticClass:"line-number"},[s._v("41")]),r("br"),r("span",{staticClass:"line-number"},[s._v("42")]),r("br"),r("span",{staticClass:"line-number"},[s._v("43")]),r("br"),r("span",{staticClass:"line-number"},[s._v("44")]),r("br"),r("span",{staticClass:"line-number"},[s._v("45")]),r("br"),r("span",{staticClass:"line-number"},[s._v("46")]),r("br"),r("span",{staticClass:"line-number"},[s._v("47")]),r("br"),r("span",{staticClass:"line-number"},[s._v("48")]),r("br"),r("span",{staticClass:"line-number"},[s._v("49")]),r("br"),r("span",{staticClass:"line-number"},[s._v("50")]),r("br"),r("span",{staticClass:"line-number"},[s._v("51")]),r("br"),r("span",{staticClass:"line-number"},[s._v("52")]),r("br"),r("span",{staticClass:"line-number"},[s._v("53")]),r("br"),r("span",{staticClass:"line-number"},[s._v("54")]),r("br"),r("span",{staticClass:"line-number"},[s._v("55")]),r("br"),r("span",{staticClass:"line-number"},[s._v("56")]),r("br"),r("span",{staticClass:"line-number"},[s._v("57")]),r("br"),r("span",{staticClass:"line-number"},[s._v("58")]),r("br"),r("span",{staticClass:"line-number"},[s._v("59")]),r("br"),r("span",{staticClass:"line-number"},[s._v("60")]),r("br"),r("span",{staticClass:"line-number"},[s._v("61")]),r("br"),r("span",{staticClass:"line-number"},[s._v("62")]),r("br"),r("span",{staticClass:"line-number"},[s._v("63")]),r("br"),r("span",{staticClass:"line-number"},[s._v("64")]),r("br"),r("span",{staticClass:"line-number"},[s._v("65")]),r("br"),r("span",{staticClass:"line-number"},[s._v("66")]),r("br"),r("span",{staticClass:"line-number"},[s._v("67")]),r("br"),r("span",{staticClass:"line-number"},[s._v("68")]),r("br"),r("span",{staticClass:"line-number"},[s._v("69")]),r("br"),r("span",{staticClass:"line-number"},[s._v("70")]),r("br"),r("span",{staticClass:"line-number"},[s._v("71")]),r("br"),r("span",{staticClass:"line-number"},[s._v("72")]),r("br"),r("span",{staticClass:"line-number"},[s._v("73")]),r("br"),r("span",{staticClass:"line-number"},[s._v("74")]),r("br"),r("span",{staticClass:"line-number"},[s._v("75")]),r("br"),r("span",{staticClass:"line-number"},[s._v("76")]),r("br"),r("span",{staticClass:"line-number"},[s._v("77")]),r("br"),r("span",{staticClass:"line-number"},[s._v("78")]),r("br"),r("span",{staticClass:"line-number"},[s._v("79")]),r("br"),r("span",{staticClass:"line-number"},[s._v("80")]),r("br"),r("span",{staticClass:"line-number"},[s._v("81")]),r("br"),r("span",{staticClass:"line-number"},[s._v("82")]),r("br"),r("span",{staticClass:"line-number"},[s._v("83")]),r("br"),r("span",{staticClass:"line-number"},[s._v("84")]),r("br"),r("span",{staticClass:"line-number"},[s._v("85")]),r("br"),r("span",{staticClass:"line-number"},[s._v("86")]),r("br"),r("span",{staticClass:"line-number"},[s._v("87")]),r("br"),r("span",{staticClass:"line-number"},[s._v("88")]),r("br"),r("span",{staticClass:"line-number"},[s._v("89")]),r("br"),r("span",{staticClass:"line-number"},[s._v("90")]),r("br"),r("span",{staticClass:"line-number"},[s._v("91")]),r("br"),r("span",{staticClass:"line-number"},[s._v("92")]),r("br"),r("span",{staticClass:"line-number"},[s._v("93")]),r("br"),r("span",{staticClass:"line-number"},[s._v("94")]),r("br"),r("span",{staticClass:"line-number"},[s._v("95")]),r("br"),r("span",{staticClass:"line-number"},[s._v("96")]),r("br"),r("span",{staticClass:"line-number"},[s._v("97")]),r("br"),r("span",{staticClass:"line-number"},[s._v("98")]),r("br"),r("span",{staticClass:"line-number"},[s._v("99")]),r("br"),r("span",{staticClass:"line-number"},[s._v("100")]),r("br"),r("span",{staticClass:"line-number"},[s._v("101")]),r("br"),r("span",{staticClass:"line-number"},[s._v("102")]),r("br"),r("span",{staticClass:"line-number"},[s._v("103")]),r("br"),r("span",{staticClass:"line-number"},[s._v("104")]),r("br"),r("span",{staticClass:"line-number"},[s._v("105")]),r("br"),r("span",{staticClass:"line-number"},[s._v("106")]),r("br"),r("span",{staticClass:"line-number"},[s._v("107")]),r("br"),r("span",{staticClass:"line-number"},[s._v("108")]),r("br"),r("span",{staticClass:"line-number"},[s._v("109")]),r("br")])]),r("h2",{attrs:{id:"_3-7-增加公网负载均衡器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-增加公网负载均衡器"}},[s._v("#")]),s._v(" 3.7 增加公网负载均衡器")]),s._v(" "),r("h3",{attrs:{id:"_3-7-1-应用访问架构图"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-1-应用访问架构图"}},[s._v("#")]),s._v(" 3.7.1 应用访问架构图")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px","margin-left":"10px"},attrs:{src:t(669)}})]),s._v(" "),r("h3",{attrs:{id:"_3-7-2-安装nginx"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-2-安装nginx"}},[s._v("#")]),s._v(" 3.7.2 安装nginx")]),s._v(" "),r("ul",[r("li",[r("code",[s._v("在 192.168.56.66中部署")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1. 配置nginx YUM源'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repos"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo\n​"),r("span",{pre:!0,attrs:{class:"token template-string"}},[r("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),r("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),r("span",{pre:!0,attrs:{class:"token template-string"}},[r("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("\n[nginx]\nname=nginx repo\n# 下面这行centos根据你自己的操作系统修改比如：OS/rehel\n# 6是你Linux系统的版本，可以通过URL查看路径是否正确\nbaseurl=http://nginx.org/packages/centos/7/$basearch/\ngpgcheck=0\nenabled=1\n​")]),r("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),r("span",{pre:!0,attrs:{class:"token template-string"}},[r("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),r("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2. 安装nginx'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@linux"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" yum "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install nginx\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])]),r("h3",{attrs:{id:"_3-7-3-使用nginx部署公网负载均衡器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-3-使用nginx部署公网负载均衡器"}},[s._v("#")]),s._v(" 3.7.3 使用nginx部署公网负载均衡器")]),s._v(" "),r("ul",[r("li",[s._v("1）客户端访问："),r("code",[s._v("java.example.com:81")]),s._v("（java.example.com 解析地址 192.168.56.66）")]),s._v(" "),r("li",[s._v("2）192.168.56.66是公网负载均衡器，"),r("code",[s._v("将请求转发给 Ingress Controller")]),s._v("（192.168.56.62、192.168.56.63）")]),s._v(" "),r("li",[s._v("3）Ingress Controller会"),r("code",[s._v("根据请求地址 java.example.com 分发到对应的pod节点中")])])]),s._v(" "),r("div",{staticClass:"language-json line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[s._v("# vim /etc/nginx/nginx.conf\n\n# ingress controller所在节点\nupstream java-demo "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  server "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("56.62")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(";\n  server "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("56.63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(";\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n# 如果需要代理多个服务，只需要在这里添加 server 块，server_name 修改成对应的即可\nserver "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  listen "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("81")]),s._v(";\n  server_name java.example.com;\n  location / "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    proxy_pass http"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//java-demo;")]),s._v("\n    proxy_set_header Host $Host;\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br")])]),r("h3",{attrs:{id:"_3-7-4-测试访问"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-4-测试访问"}},[s._v("#")]),s._v(" 3.7.4 测试访问")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("添加域名解析（两个节点都可以）")]),s._v(" "),r("ul",[r("li",[s._v("修改 C:\\Windows\\System32\\drivers\\etc\\hosts 记录")]),s._v(" "),r("li",[s._v("添加： 192.168.56.66  java.example.com")]),s._v(" "),r("li",[s._v("然后通过：http://java.example.com:81/    访问网站")])])]),s._v(" "),r("li",[r("p",[s._v("访问结果")])])]),s._v(" "),r("p",[r("img",{staticStyle:{width:"600px","margin-left":"50px"},attrs:{src:t(670)}})])])}),[],!1,null,null,null);a.default=n.exports}}]);