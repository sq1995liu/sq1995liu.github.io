(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{658:function(s,a,t){s.exports=t.p+"assets/img/image-20210128092354268.952511d0.png"},659:function(s,a,t){s.exports=t.p+"assets/img/image-20210128092454383.6aee5a48.png"},660:function(s,a,t){s.exports=t.p+"assets/img/image-20210128093031757.5439bc06.png"},661:function(s,a,t){s.exports=t.p+"assets/img/image-20210128101335663.df02f177.png"},662:function(s,a,t){s.exports=t.p+"assets/img/image-20210128101530117.1409a727.png"},663:function(s,a,t){s.exports=t.p+"assets/img/image-20210128103223634.fa9d6fa7.png"},664:function(s,a,t){s.exports=t.p+"assets/img/image-20210128103502571.fb901764.png"},997:function(s,a,t){"use strict";t.r(a);var r=t(21),n=Object(r.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h1",{attrs:{id:"_01-service基本概念"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_01-service基本概念"}},[s._v("#")]),s._v(" 01.Service基本概念")]),s._v(" "),r("h2",{attrs:{id:"_1-1-service是什么？"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-service是什么？"}},[s._v("#")]),s._v(" 1.1 Service是什么？")]),s._v(" "),r("ul",[r("li",[s._v("背景：每个Pod具有IP地址，当使用Deployment控制器时，Pod的IP地址往往动态变化。")]),s._v(" "),r("li",[s._v("解决方法：通过Service可以获得稳定的IP地址，且在Service的生命周期有效，与Pod的IP地址变化与否无关。")]),s._v(" "),r("li",[s._v("实质：Service本质就是一个LB负载均衡器")])]),s._v(" "),r("h2",{attrs:{id:"_1-2-service存在的意义"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-service存在的意义"}},[s._v("#")]),s._v(" 1.2 Service存在的意义")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"700px","margin-left":"50px"},attrs:{src:t(658)}})]),s._v(" "),r("h2",{attrs:{id:"_1-3-pod与service的关系"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-pod与service的关系"}},[s._v("#")]),s._v(" 1.3 Pod与Service的关系")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px","margin-left":"50px"},attrs:{src:t(659)}})]),s._v(" "),r("h1",{attrs:{id:"_02-service定义和创建"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_02-service定义和创建"}},[s._v("#")]),s._v(" 02.Service定义和创建")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"700px","margin-left":"50px"},attrs:{src:t(660)}})]),s._v(" "),r("h2",{attrs:{id:"_2-1-先使用yaml文件部署三个nginx"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-先使用yaml文件部署三个nginx"}},[s._v("#")]),s._v(" 2.1 先使用yaml文件部署三个nginx")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim deployment"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" apps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Deployment\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment\n  labels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx\nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  replicas"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  selector"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    matchLabels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx\n  template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    metadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      labels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx\n    spec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      containers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx\n        image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.14")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),s._v("\n        ports"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" containerPort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br")])]),r("ul",[r("li",[s._v("可以查看刚刚部署nginx服务标签：nginx")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("show"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("labels\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                       "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LABELS")]),s._v("\nnginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6799")]),s._v("fc88d8"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s5rnz           "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("d   app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hash"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6799")]),s._v("fc88d8\nnginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("b6c48dd5"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hxv7h   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("s   app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hash"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("b6c48dd5\nnginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("b6c48dd5"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("jjkk4   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("s   app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hash"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("b6c48dd5\nnginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("b6c48dd5"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tsgvb   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("s   app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hash"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("b6c48dd5\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("ul",[r("li",[s._v("查看当前机器部署了那些服务")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" svc\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TYPE")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLUSTER")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EXTERNAL")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORT")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("S")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\nkubernetes   ClusterIP     "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("d\nnginx        NodePort    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.108")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".41")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("31434")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("d\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("h2",{attrs:{id:"_2-2-service定义与创建"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-service定义与创建"}},[s._v("#")]),s._v(" 2.2 Service定义与创建")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim service"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Service\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" web\n  namespace"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  ports"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("        # Service端口\n    protocol"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("    # 协议\n    targetPort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("   # 容器端口（程序启动端口，比如django默认是"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("端口）\n  selector"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" \n    app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx      # 指定关联Pod的标签（上面已经查到了，app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx）\n  type"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ClusterIP      # 服务类型\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br")])]),r("ul",[r("li",[s._v("创建service")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f service"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h2",{attrs:{id:"_2-3-通过service访问nginx集群"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-通过service访问nginx集群"}},[s._v("#")]),s._v(" 2.3 通过Service访问nginx集群")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" svc\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TYPE")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLUSTER")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EXTERNAL")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORT")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("S")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\nkubernetes    ClusterIP    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v("       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("d\nnginx        NodePort    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.108")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".41")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("31434")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("d\nweb         ClusterIP    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.105")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".53")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".183")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("       "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("m40s\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# curl "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.105")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".53")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".183")]),s._v("        # 可以通过web的地址访问后面三个nginx集群\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" svc web2     # 可以删除其中一个\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("h1",{attrs:{id:"_03-service三种常用类型"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_03-service三种常用类型"}},[s._v("#")]),s._v(" 03.Service三种常用类型")]),s._v(" "),r("ul",[r("li",[r("p",[r("strong",[r("code",[s._v("ClusterIP")]),s._v("：集群内部使用")])])]),s._v(" "),r("li",[r("p",[r("strong",[r("code",[s._v("NodePort")]),s._v("：对外暴露应用（集群外）")])])]),s._v(" "),r("li",[r("p",[r("strong",[r("code",[s._v("LoadBalancer")]),s._v("：对外暴露应用，适用公有云")])])])]),s._v(" "),r("h2",{attrs:{id:"_3-1-clusterip（vip）"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-clusterip（vip）"}},[s._v("#")]),s._v(" 3.1 ClusterIP（VIP）")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px","margin-left":"50px"},attrs:{src:t(661)}})]),s._v(" "),r("h2",{attrs:{id:"_3-2-nodeport"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-nodeport"}},[s._v("#")]),s._v(" 3.2 NodePort")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px","margin-left":"50px"},attrs:{src:t(662)}})]),s._v(" "),r("h3",{attrs:{id:"_3-2-1-先使用yaml文件部署三个nginx"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-先使用yaml文件部署三个nginx"}},[s._v("#")]),s._v(" 3.2.1 先使用yaml文件部署三个nginx")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim deployment"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" apps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Deployment\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment\n  labels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx\nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  replicas"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  selector"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    matchLabels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx\n  template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    metadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      labels"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx\n    spec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      containers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx\n        image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.14")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),s._v("\n        ports"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" containerPort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br")])]),r("ul",[r("li",[s._v("可以查看刚刚部署nginx服务标签：nginx")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("show"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("labels\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                       "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("LABELS")]),s._v("\nnginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6799")]),s._v("fc88d8"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s5rnz           "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("d   app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hash"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6799")]),s._v("fc88d8\nnginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("b6c48dd5"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hxv7h   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("s   app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hash"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("b6c48dd5\nnginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("b6c48dd5"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("jjkk4   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("s   app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hash"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("b6c48dd5\nnginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deployment"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("b6c48dd5"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tsgvb   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("s   app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("template"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hash"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v("b6c48dd5\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("h3",{attrs:{id:"_3-2-2-使用nodeport创建service"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-使用nodeport创建service"}},[s._v("#")]),s._v(" 3.2.2 使用NodePort创建Service")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodeport"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Service\nmetadata"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" web"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodeport\n  namespace"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  ports"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("        # Service端口\n    protocol"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("    # 协议\n    targetPort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("    # 容器端口（程序启动端口，比如django默认是"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("端口）\n    nodePort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30706")]),s._v("   # 指定NodePort监听的外网端口\n  selector"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" \n    app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" nginx      # 指定关联Pod的标签（上面已经查到了，app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx）\n  type"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NodePort      # "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("服务类型")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("只需要把服务类型修改成NodePort即可"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br")])]),r("ul",[r("li",[s._v("创建Service")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nodeport"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml \n\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h3",{attrs:{id:"_3-2-3-访问"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-访问"}},[s._v("#")]),s._v(" 3.2.3 访问")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("访问地址：<任意NodeIP>:NodePort")])]),s._v(" "),r("li",[r("p",[s._v("端口范围：30000-32767")])])]),s._v(" "),r("p",[r("img",{staticStyle:{width:"400px","margin-left":"50px"},attrs:{src:"assets/image-20210128102559155.png"}})]),s._v(" "),r("h3",{attrs:{id:"_3-2-4-nodeport存在弊端"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-nodeport存在弊端"}},[s._v("#")]),s._v(" 3.2.4 NodePort存在弊端")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px","margin-left":"50px"},attrs:{src:t(663)}})]),s._v(" "),r("h2",{attrs:{id:"_3-3-loadbalancer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-loadbalancer"}},[s._v("#")]),s._v(" 3.3 LoadBalancer")]),s._v(" "),r("h3",{attrs:{id:"_3-3-1-lb说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-lb说明"}},[s._v("#")]),s._v(" 3.3.1 LB说明")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("负责均衡器有哪些：nginx、LVS、haproxy")])]),s._v(" "),r("li",[r("p",[s._v("私有云：SLB")])])]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px","margin-left":"50px"},attrs:{src:t(664)}})]),s._v(" "),r("h3",{attrs:{id:"_3-3-2-配置lb"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-配置lb"}},[s._v("#")]),s._v(" 3.3.2 配置LB")]),s._v(" "),r("ul",[r("li",[s._v("直接找一个nginx配置反向代理即可")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("stream "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log_format  main  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr $upstream_addr - [$time_local] $status $upstream_bytes_sent'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    access_log  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("django"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("access"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    upstream django"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                server "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".62")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30706")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                server "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30706")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   \n    server "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       listen "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       proxy_pass django"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);