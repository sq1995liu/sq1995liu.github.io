(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{640:function(s,t,a){s.exports=a.p+"assets/img/image-20201221132229354.89f9a110.png"},641:function(s,t,a){s.exports=a.p+"assets/img/image-20201228101040143.a71bb549.png"},642:function(s,t,a){s.exports=a.p+"assets/img/image-20201228160820281.242c30fc.png"},643:function(s,t,a){s.exports=a.p+"assets/img/image-20201228162714535.1f661654.png"},991:function(s,t,a){"use strict";a.r(t);var r=a(21),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,r=s._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、安装docker\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、创建一个master节点\nkubeadm init\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、讲一个Node节点加入到当前集群\nkubeadm join "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Master节点的"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("和端口"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("、部署容器网络"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CNI")]),s._v("\nkubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f calico"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("、部署Web "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UI")]),s._v("（DashBoard）\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("h1",{attrs:{id:"_01-kubeadm安装k8s集群架构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_01-kubeadm安装k8s集群架构"}},[s._v("#")]),s._v(" 01.kubeadm安装k8s集群架构")]),s._v(" "),r("h2",{attrs:{id:"_1-1-kubeadm介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-kubeadm介绍"}},[s._v("#")]),s._v(" 1.1 kubeadm介绍")]),s._v(" "),r("ul",[r("li",[s._v("kubeadm是官方社区推出的一个用于快速部署kubernetes集群的工具。")]),s._v(" "),r("li",[s._v("这个工具能通过两条指令完成一个kubernetes集群的部署")]),s._v(" "),r("li",[s._v("kubeadm不单纯是简化部署k8s集群，采用了容器化部署k8s组件（"),r("code",[s._v("只有 kubelet是非容器化部署的")]),s._v("）")])]),s._v(" "),r("div",{staticClass:"language-python line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-python"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个 Master 节点")]),s._v("\n$ kubeadm init\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将一个 Node 节点加入到当前集群中")]),s._v("\n$ kubeadm join "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Master节点的IP和端口 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("h2",{attrs:{id:"_1-2-kubeadm安装架构说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-kubeadm安装架构说明"}},[s._v("#")]),s._v(" 1.2 kubeadm安装架构说明")]),s._v(" "),r("table",[r("thead",[r("tr",[r("th",[s._v("角色")]),s._v(" "),r("th",[s._v("IP")])])]),s._v(" "),r("tbody",[r("tr",[r("td",[s._v("k8s-master")]),s._v(" "),r("td",[s._v("192.168.31.61")])]),s._v(" "),r("tr",[r("td",[s._v("k8s-node1")]),s._v(" "),r("td",[s._v("192.168.31.62")])]),s._v(" "),r("tr",[r("td",[s._v("k8s-node2")]),s._v(" "),r("td",[s._v("192.168.31.63")])])])]),s._v(" "),r("p",[r("img",{staticStyle:{width:"800px","margin-left":"20px"},attrs:{src:a(640)}})]),s._v(" "),r("h1",{attrs:{id:"_02-环境准备【所有节点】"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_02-环境准备【所有节点】"}},[s._v("#")]),s._v(" 02.环境准备【所有节点】")]),s._v(" "),r("h2",{attrs:{id:"_2-1-安装要求"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装要求"}},[s._v("#")]),s._v(" 2.1 安装要求")]),s._v(" "),r("p",[s._v("在开始之前，部署Kubernetes集群机器需要满足以下几个条件：")]),s._v(" "),r("h3",{attrs:{id:"_2-1-1-操作系统和硬件要求"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-操作系统和硬件要求"}},[s._v("#")]),s._v(" 2.1.1 操作系统和硬件要求")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("1、操作系统要求")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("一台或多台机器，操作系统 CentOS7.x-86_x64（最好是7.4~7.8版本）")])]),s._v(" "),r("li",[r("p",[s._v("如果是7.1~7.3版本的建议更新一下内核")])]),s._v(" "),r("li",[r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# yum update "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("  reboot\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])])])])]),s._v(" "),r("li",[r("p",[s._v("2、硬件配置")]),s._v(" "),r("ul",[r("li",[s._v("2GB或更多RAM，2个CPU或更多CPU，硬盘30GB或更多")])])]),s._v(" "),r("li",[r("p",[s._v("3、网络要求")]),s._v(" "),r("ul",[r("li",[s._v("集群中所有机器之间网络互通，可以访问外网，需要拉取镜像")])])])]),s._v(" "),r("h3",{attrs:{id:"_2-1-2-关闭防火墙和swap分区"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-关闭防火墙和swap分区"}},[s._v("#")]),s._v(" 2.1.2 关闭防火墙和swap分区")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.关闭防火墙'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl stop firewalld\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl disable firewalld\n\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.关闭selinux'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# sed "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/enforcing/disabled/'")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("selinux"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("config        # 永久\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# setenforce "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      # 临时\n\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.关闭swap'")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# swapoff "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a        # 临时\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("fstab     # "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("永久")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("注释掉下面即可"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n#"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dev"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mapper"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("swap     swap                    swap    defaults        "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# free "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m          # 查看是否已经关闭\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])]),r("h3",{attrs:{id:"_2-1-3-修改主机名"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-修改主机名"}},[s._v("#")]),s._v(" 2.1.3 修改主机名")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.修改三台机器主机名  '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# hostnamectl set"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hostname k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("slave "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# hostnamectl set"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hostname k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# hostnamectl set"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hostname k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2\n\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.添加hosts解析  '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("hosts     # 添加下面域名解析     \n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".61")]),s._v(" k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".62")]),s._v(" k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".63")]),s._v(" k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("h3",{attrs:{id:"_2-1-4-将桥接的ipv4流量传递到iptables的链"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-将桥接的ipv4流量传递到iptables的链"}},[s._v("#")]),s._v(" 2.1.4 将桥接的IPv4流量传递到iptables的链")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  cat "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sysctl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EOF")]),s._v("\nnet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nf"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("call"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ip6tables "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nf"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("call"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("iptables "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EOF")]),s._v("\n \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  sysctl "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("system      # 生效\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("h3",{attrs:{id:"_2-1-5-同步时间"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-5-同步时间"}},[s._v("#")]),s._v(" 2.1.5 同步时间")]),s._v(" "),r("ul",[r("li",[s._v("k8s的https证书会根据时间来检查有效期")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  yum install ntpdate "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  ntpdate time"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("windows"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h1",{attrs:{id:"_03-安装docker-kubeadm-kubelet【所有节点】"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_03-安装docker-kubeadm-kubelet【所有节点】"}},[s._v("#")]),s._v(" 03. 安装Docker/kubeadm/kubelet【所有节点】")]),s._v(" "),r("ul",[r("li",[s._v("Kubernetes默认CRI（容器运行时）为Docker，因此先安装Docker。")]),s._v(" "),r("li",[s._v("k8s-master节点和所有node节点都需要安装这些组件")])]),s._v(" "),r("h2",{attrs:{id:"_3-1-安装docker"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-安装docker"}},[s._v("#")]),s._v(" 3.1 安装Docker")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  yum "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install wget\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  wget https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mirrors"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ce"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("linux"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("centos"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ce"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("O")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repos"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ce"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  yum "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y install docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ce\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  systemctl enable docker "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl start docker\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("ul",[r("li",[s._v("配置镜像下载加速器：")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  cat "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daemon"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EOF")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://b9pmyelo.mirror.aliyuncs.com"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EOF")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  systemctl restart docker\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  docker info\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("h2",{attrs:{id:"_3-2-添加阿里云yum软件源"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-添加阿里云yum软件源"}},[s._v("#")]),s._v(" 3.2 添加阿里云YUM软件源")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  cat "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token regex"}},[r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("etc")]),r("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token regex-flags"}},[s._v("yum")])]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repos"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EOF")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nname"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Kubernetes\nbaseurl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mirrors"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("repos"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("el7"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x86_64\nenabled"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\ngpgcheck"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nrepo_gpgcheck"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ngpgkey"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mirrors"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("doc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gpg https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mirrors"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("doc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rpm"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gpg\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EOF")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br")])]),r("h2",{attrs:{id:"_3-3-安装kubeadm，kubelet和kubectl"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-安装kubeadm，kubelet和kubectl"}},[s._v("#")]),s._v(" 3.3 安装kubeadm，kubelet和kubectl")]),s._v(" "),r("ul",[r("li",[r("code",[s._v("由于版本更新频繁，这里指定版本号部署")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  yum install "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.19")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v(" kubeadm"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.19")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v(" kubectl"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.19")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  systemctl enable kubelet\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("ul",[r("li",[s._v("k8s-master\n"),r("ul",[r("li",[s._v("kube-apiserver")]),s._v(" "),r("li",[s._v("kube-scheduler")]),s._v(" "),r("li",[s._v("kube-controller-manager")]),s._v(" "),r("li",[s._v("etcd")])])]),s._v(" "),r("li",[s._v("k8s-node\n"),r("ul",[r("li",[s._v("kubelet")]),s._v(" "),r("li",[s._v("kube-proxy")])])])]),s._v(" "),r("h1",{attrs:{id:"_04-kubeadm-init部署k8s-master"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_04-kubeadm-init部署k8s-master"}},[s._v("#")]),s._v(" 04.  kubeadm init部署k8s-master")]),s._v(" "),r("ul",[r("li",[s._v("==只需要在k8s-master-192.168.56.61上安装即可==")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("zh"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("reference"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("setup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tools"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubeadm"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubeadm"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("init"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("#config"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file \nhttps"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docs"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("setup"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("production"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("environment"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tools"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubeadm"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("create"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kubeadm"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("#initializing"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("your"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("control"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plane"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h2",{attrs:{id:"_4-1-法1：使用命令行部署k8s-master"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-法1：使用命令行部署k8s-master"}},[s._v("#")]),s._v(" 4.1 法1：使用命令行部署k8s-master")]),s._v(" "),r("h3",{attrs:{id:"_4-1-1-执行部署k8s-master命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1-执行部署k8s-master命令"}},[s._v("#")]),s._v(" 4.1.1 执行部署k8s-master命令")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubeadm init \\\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("advertise"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".61")]),s._v(" \\\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("repository registry"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers \\\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("version v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.0")]),s._v(" \\\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("service"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cidr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" \\\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("pod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("network"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cidr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" \\\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("ignore"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("preflight"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("errors"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("all\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("ul",[r("li",[s._v("--apiserver-advertise-address 集群通告地址")]),s._v(" "),r("li",[s._v("--image-repository  由于默认拉取镜像地址k8s.gcr.io国内无法访问，这里指定阿里云镜像仓库地址")]),s._v(" "),r("li",[s._v("--kubernetes-version K8s版本，与上面安装的一致")]),s._v(" "),r("li",[s._v("--service-cidr 集群内部虚拟网络，Pod统一访问入口")]),s._v(" "),r("li",[s._v("--pod-network-cidr Pod网络，，与下面部署的CNI网络组件yaml中保持一致")])]),s._v(" "),r("h3",{attrs:{id:"_4-1-2-将集群的配置文件复制到指定位置"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-2-将集群的配置文件复制到指定位置"}},[s._v("#")]),s._v(" 4.1.2 将集群的配置文件复制到指定位置")]),s._v(" "),r("p",[r("img",{staticStyle:{width:"600px","margin-left":"20px"},attrs:{src:a(641)}})]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  mkdir "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kube\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  sudo cp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("admin"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("config\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  sudo chown "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("g"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("config\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("ul",[r("li",[s._v("确定k8s-master是否安装成功")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" nodes\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLES")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VERSION")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master   NotReady   master   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("h37m   v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.0")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("ul",[r("li",[s._v("这个信息一定要留着，一会node节点加入集群还要用")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("kubeadm join "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".61")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("token k82ja8"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("p4bu6a1kcq119kts \\\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("discovery"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hash sha256"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("ea23b5c494bf8fff4577b66bbfeeea65ac72ac80e3e3d93e5f1ed62936a48ef9 \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h2",{attrs:{id:"_4-2-法2：使用配置文件引导"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-法2：使用配置文件引导"}},[s._v("#")]),s._v(" 4.2 法2：使用配置文件引导")]),s._v(" "),r("h3",{attrs:{id:"_4-2-1-编辑kubeadm-conf配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-编辑kubeadm-conf配置文件"}},[s._v("#")]),s._v(" 4.2.1 编辑kubeadm.conf配置文件")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  vi kubeadm"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\napiVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kubeadm"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v1beta2\nkind"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ClusterConfiguration\nkubernetesVersion"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.0")]),s._v("\nimageRepository"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" registry"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers \nnetworking"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  podSubnet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" \n  serviceSubnet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" \n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubeadm init "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("config kubeadm"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("ignore"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("preflight"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("errors"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("all  \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("h3",{attrs:{id:"_4-2-2-拷贝kubectl使用的连接k8s认证文件到默认路径"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-拷贝kubectl使用的连接k8s认证文件到默认路径"}},[s._v("#")]),s._v(" 4.2.2 拷贝kubectl使用的连接k8s认证文件到默认路径")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  mkdir "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kube\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  sudo cp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("admin"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("config\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  sudo chown "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("g"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("config\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("ul",[r("li",[s._v("确定k8s-master是否安装成功")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" nodes\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLES")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VERSION")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master     Ready    master   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("m   v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.0")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("h2",{attrs:{id:"_4-3-kubeadm-init初始化工作"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-kubeadm-init初始化工作"}},[s._v("#")]),s._v(" 4.3 kubeadm init初始化工作")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("1、[preflight] 环境检查和拉取镜像  kubeadm  config  images pull")])]),s._v(" "),r("li",[r("p",[s._v("2、[certs] 生成k8s证书 和  etcd 证书，为了使用https")]),s._v(" "),r("ul",[r("li",[r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# ll "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pki"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n  total "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1269")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("crt\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1135")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" apiserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("crt\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1679")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" apiserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("etcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1675")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" apiserver"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1143")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" apiserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("crt\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1675")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" apiserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kubelet"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1066")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("crt\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1679")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key\n  drwxr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("xr"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("162")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" etcd\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1078")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" front"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("crt\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1675")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" front"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("r"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1103")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" front"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("crt\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1679")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" front"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1675")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" sa"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rw"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("451")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" sa"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pub\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br")])])])])]),s._v(" "),r("li",[r("p",[s._v("3、[kubeconfig] 生成 kubeconfig 配置文件，配置其他组件连接kube-apiserver")])]),s._v(" "),r("li",[r("p",[s._v("4、[kubelet-start] 生成 kubelet配置文件")])]),s._v(" "),r("li",[r("p",[s._v("5、[control-plane] 部署管理节点组件，用镜像启动容器")])]),s._v(" "),r("li",[r("p",[s._v("6、[etcd] 使用镜像部署etcd数据库")])]),s._v(" "),r("li",[r("p",[s._v("7、[upload-config] [kubelet] [upload-certs] 上传配置文件到k8s中")])]),s._v(" "),r("li",[r("p",[s._v("8、[mark-conrol-plane] 添加角色是 master还是node")])]),s._v(" "),r("li",[r("p",[s._v("9、[bootstrap-token] 自动为kubelet颁发证书的token")])]),s._v(" "),r("li",[r("p",[s._v("10、[addons] 部署插件，CoreDNS、kube-proxy")])]),s._v(" "),r("li",[r("p",[s._v("11、最后：拷贝连接k8s集群认证文件到默认路径下")]),s._v(" "),r("ul",[r("li",[r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  mkdir "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kube\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  sudo cp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("admin"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("config\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  sudo chown "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("g"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" $"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HOME")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("config\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])])])])]),s._v(" "),r("li",[r("p",[s._v("12、加入node节点")]),s._v(" "),r("ul",[r("li",[r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("  kubeadm join "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".61")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("token n4s486"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("e19tb1cth8bo3w0z \\\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("discovery"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hash sha256"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3e4")]),s._v("a7f11a8b4fa1b7c8740426736813198f8d77670d705335fef56edfbb80869 \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])])])])])]),s._v(" "),r("h2",{attrs:{id:"_4-4-如果kubeadm-init执行失败如何解决"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-如果kubeadm-init执行失败如何解决"}},[s._v("#")]),s._v(" 4.4 如果kubeadm init执行失败如何解决")]),s._v(" "),r("ul",[r("li",[s._v("执行 "),r("code",[s._v("kubeadm reset")]),s._v("重置环境，k8s-maser节点和k8s-node节点都需要执行")]),s._v(" "),r("li",[s._v("然后从新执行 kubeadm init  命令安装")])]),s._v(" "),r("h1",{attrs:{id:"_05-加入kubernetes-node"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_05-加入kubernetes-node"}},[s._v("#")]),s._v(" 05. 加入Kubernetes Node")]),s._v(" "),r("h2",{attrs:{id:"_5-1-将k8s-node1和node2节点加入集群"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-将k8s-node1和node2节点加入集群"}},[s._v("#")]),s._v(" 5.1 将k8s-node1和node2节点加入集群")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("在192.168.56.62/63（Node）执行")])]),s._v(" "),r("li",[r("p",[s._v("向集群添加新节点，执行在kubeadm init输出的kubeadm join命令")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("kubeadm join "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".56")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".61")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("token n4s486"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("e19tb1cth8bo3w0z \\\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("discovery"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hash sha256"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3e4")]),s._v("a7f11a8b4fa1b7c8740426736813198f8d77670d705335fef56edfbb80869 \n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("ul",[r("li",[s._v("在k8s-master上查看当前节点状态,由于缺少CNI网络组件，所以当前是NotReady状态")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.查看集群状态 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" nodes\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLES")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VERSION")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master    NotReady   master    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("m25s    v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.0")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1     NotReady   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("s     v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.0")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2     NotReady   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("s     v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.0")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.查看kubelet日志，找到报错原因 '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# journalctl "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u kubelet "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" k1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log     \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# tail "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f k1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log \n# 可以参考kubelet日志，可以看到报cni网络更新错误（Unable to update cni config"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" no networks found "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cni"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("net"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d）\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("h2",{attrs:{id:"_5-2-重新生成token"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-重新生成token"}},[s._v("#")]),s._v(" 5.2 重新生成token")]),s._v(" "),r("ul",[r("li",[s._v("默认token有效期为24小时，当过期之后，该token就不可用了。")]),s._v(" "),r("li",[s._v("这时就需要重新创建token，操作如下：")])]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("$ kubeadm token create\n$ kubeadm token list\n$ openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'\n63bca849e0e01691ae14eab449570284f0c3ddeea590f8da988c07fe2729e924\n\n$ kubeadm join 192.168.31.61:6443 --token nuja6n.o3jrhsffiqs9swnu --discovery-token-ca-cert-hash sha256:63bca849e0e01691ae14eab449570284f0c3ddeea590f8da988c07fe2729e924\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("p",[s._v("或者直接命令快捷生成：kubeadm token create --print-join-command")]),s._v(" "),r("p",[r("a",{attrs:{href:"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-join/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-join/"),r("OutboundLink")],1)]),s._v(" "),r("h1",{attrs:{id:"_06-部署容器网络（cni）"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_06-部署容器网络（cni）"}},[s._v("#")]),s._v(" 06. 部署容器网络（CNI）")]),s._v(" "),r("p",[s._v("https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#pod-network")]),s._v(" "),r("p",[s._v("https://docs.projectcalico.org/getting-started/kubernetes/quickstart")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("注意：只需要部署下面其中一个，推荐Calico。")])]),s._v(" "),r("li",[r("p",[s._v("Calico是一个纯三层的数据中心网络方案，Calico支持广泛的平台，包括Kubernetes、OpenStack等。")])]),s._v(" "),r("li",[r("p",[s._v("Calico 在每一个计算节点利用 Linux Kernel 实现了一个高效的虚拟路由器（ vRouter） 来负责数据转发，而每个 vRouter 通过 BGP 协议负责把自己上运行的 workload 的路由信息向整个 Calico 网络内传播。")])]),s._v(" "),r("li",[r("p",[s._v("此外，Calico  项目还实现了 Kubernetes 网络策略，提供ACL功能。")])]),s._v(" "),r("li",[r("p",[s._v("下载完后还需要修改里面定义Pod网络（CALICO_IPV4POOL_CIDR），与前面kubeadm init指定的一样")])]),s._v(" "),r("li",[r("p",[s._v("修改完后应用清单")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# wget https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docs"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("projectcalico"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("org"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manifests"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim calico"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n# 搜索 "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CALICO_IPV4POOL_CIDR"')]),s._v("关键字，将value中默认的value"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.0.0/16"')]),s._v(" 修改成 value"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.244.0.0/16"')]),s._v("\n# 必须要和部署k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("maser中指定的地址相同\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" name"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CALICO_IPV4POOL_CIDR")]),s._v("\n  value"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.244.0.0/16"')]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f calico"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  cat calico"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep image              # calico要下载很多镜像，从docker官网，会比较慢\n          image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cni"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("v3"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("17.1")]),s._v("\n          image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cni"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("v3"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("17.1")]),s._v("\n          image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("pod2daemon"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flexvol"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("v3"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("17.1")]),s._v("\n          image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("v3"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("17.1")]),s._v("\n          image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" docker"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("calico"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controllers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("v3"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("17.1")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" node                      # 当部署完成后就可以看到所有节点都变成 Ready状态\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ROLES")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VERSION")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master    Ready    master   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("m   v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.0")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1     Ready    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v("m   v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.0")]),s._v("\nk8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2     Ready    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v("m   v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.0")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br")])]),r("h1",{attrs:{id:"_07-部署-dashboard"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_07-部署-dashboard"}},[s._v("#")]),s._v(" 07. 部署 Dashboard")]),s._v(" "),r("h2",{attrs:{id:"_7-1-下载recommended-yaml配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-下载recommended-yaml配置文件"}},[s._v("#")]),s._v(" 7.1 下载recommended.yaml配置文件")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  wget https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("raw"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dashboard"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("v2"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("aio"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("deploy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("recommended"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("ul",[r("li",[s._v("如果国内无法打开 raw.githubusercontent.com 怎么办")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("上https"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipaddress"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com查一下raw"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com的ipv4地址，比如我现在查到的是"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("199.232")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".96")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".133")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("hosts\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("199.232")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".96")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".133")]),s._v(" raw"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("h2",{attrs:{id:"_7-2-修改配置文件并部署"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-修改配置文件并部署"}},[s._v("#")]),s._v(" 7.2 修改配置文件并部署")]),s._v(" "),r("ul",[r("li",[s._v("默认Dashboard只能集群内部访问，修改Service为NodePort类型，暴露到外部：")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim  recommended"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n# 这个是官方原始配置，默认使用 kubectl proxy代理模式\nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  ports"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n      targetPort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("\n  selector"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard\n\n# 需要将上面的配置添加两个产生：type"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NodePort 和 nodePort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30001")]),s._v(" \nspec"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  type"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" NodePort                # 官方默认使用 kubectl proxy代理模式，这里我们修改成NodePort模式\n  ports"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n      targetPort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("\n      nodePort"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30001")]),s._v("           # 添加nodePort暴露端口为，"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30001")]),s._v("\n  selector"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard\n \n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl apply "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f recommended"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pods "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                             "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\ndashboard"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("metrics"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scraper"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("b4884c9d5"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("gl8nr   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("m\nkubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dashboard"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("f99b75bf4"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("89")]),s._v("cds      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("m\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br")])]),r("h2",{attrs:{id:"_7-3-获取认证token并登陆"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-获取认证token并登陆"}},[s._v("#")]),s._v(" 7.3 获取认证token并登陆")]),s._v(" "),r("h3",{attrs:{id:"_7-3-1-获取token"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-1-获取token"}},[s._v("#")]),s._v(" 7.3.1 获取token")]),s._v(" "),r("ul",[r("li",[r("p",[s._v("访问地址：https://NodeIP:30001")])]),s._v(" "),r("li",[r("p",[s._v("创建service account并绑定默认cluster-admin管理员集群角色：")])])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[s._v("# 创建用户\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl create serviceaccount dashboard"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admin "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system\n# 用户授权\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl create clusterrolebinding dashboard"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admin "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("clusterrole"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admin "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("serviceaccount"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("dashboard"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admin\n# 获取用户Token\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master1 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl describe secrets "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("$")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kubectl "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" secret "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" awk "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/dashboard-admin/{print $1}'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("h3",{attrs:{id:"_7-3-2-使用token登录dashboard"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-2-使用token登录dashboard"}},[s._v("#")]),s._v(" 7.3.2 使用token登录Dashboard")]),s._v(" "),r("ul",[r("li",[r("code",[s._v("访问地址：")]),s._v("https://192.168.56.62:30001/      （任意node节点地址都可以访问）")]),s._v(" "),r("li",[r("img",{staticStyle:{width:"800px","margin-left":"20px"},attrs:{src:a(642)}})])]),s._v(" "),r("h1",{attrs:{id:"_08-测试kubernetes集群"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_08-测试kubernetes集群"}},[s._v("#")]),s._v(" 08. 测试kubernetes集群")]),s._v(" "),r("ul",[r("li",[s._v("验证Pod工作")]),s._v(" "),r("li",[s._v("验证Pod网络通信")]),s._v(" "),r("li",[s._v("验证DNS解析")])]),s._v(" "),r("h2",{attrs:{id:"_8-1-部署nginx服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-部署nginx服务"}},[s._v("#")]),s._v(" 8.1 部署nginx服务")]),s._v(" "),r("blockquote",[r("p",[s._v("在Kubernetes集群中创建一个pod，验证是否正常运行")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl create deployment nginx "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("image"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl expose deployment nginx "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("type"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pod"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("svc\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                         "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\npod"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6799")]),s._v("fc88d8"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("sz6l   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("m56s\n\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TYPE")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLUSTER")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EXTERNAL")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORT")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("S")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\nservice"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes    ClusterIP    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v("       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("109")]),s._v("m\nservice"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx        NodePort    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.102")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".92")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".185")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30610")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("m44s\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("#  kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pod"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("svc\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("              "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TYPE")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLUSTER")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EXTERNAL")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORT")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("S")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\nservice"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes   ClusterIP   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v("       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v("m\nservice"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx       NodePort   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.102")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".92")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".185")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("30610")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TCP")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("m31s\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])]),r("ul",[r("li",[s._v("访问地址：http://192.168.56.62:30610/")])]),s._v(" "),r("p",[r("img",{staticStyle:{width:"600px","margin-left":"20px"},attrs:{src:a(643)}})]),s._v(" "),r("h2",{attrs:{id:"_8-2-查coredns组件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-查coredns组件"}},[s._v("#")]),s._v(" 8.2 查CoreDNS组件")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pod "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("                           "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READY")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESTARTS")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("AGE")]),s._v("\ncalico"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controllers"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("744")]),s._v("cfdf676"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("kjk2   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),s._v("m\ncalico"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n4k82                   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),s._v("m\ncalico"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t6b45                   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),s._v("m\ncalico"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tl7dc                   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),s._v("m\ncoredns"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("d56c8448f"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("kpncp              "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("116")]),s._v("m\ncoredns"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("d56c8448f"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("vx9vw              "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("116")]),s._v("m\netcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master                    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("116")]),s._v("m\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master             "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("116")]),s._v("m\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master       "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("116")]),s._v("m\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("829")]),s._v("s7                   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("116")]),s._v("m\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("jm2wt                   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("112")]),s._v("m\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("qcgxk                   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("112")]),s._v("m\nkube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master             "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("116")]),s._v("m\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br")])]),r("h1",{attrs:{id:"_09-k8s-cni通信常见问题"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_09-k8s-cni通信常见问题"}},[s._v("#")]),s._v(" 09.k8s-cni通信常见问题")]),s._v(" "),r("ul",[r("li",[s._v("1、统一管理这些k8s node网段，保障每个容器分配不一样的ip\n"),r("ul",[r("li",[s._v("给每个docker主机分配唯一的网段")])])]),s._v(" "),r("li",[s._v("2、要知道转发哪个docker主机？\n"),r("ul",[r("li",[s._v("做好记录，每个docker主机对应的网段")])])]),s._v(" "),r("li",[s._v("3、怎么实现这个转发（从docker主机1上容器发送到另一台docker主机上容器）\n"),r("ul",[r("li",[s._v("可以使用iptables或者把宿主机当做一个路由器，配置路由表")])])])]),s._v(" "),r("h1",{attrs:{id:"_10-查看集群状态"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_10-查看集群状态"}},[s._v("#")]),s._v(" 10.查看集群状态")]),s._v(" "),r("h2",{attrs:{id:"_10-1-1-查看集群状态命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-1-查看集群状态命令"}},[s._v("#")]),s._v(" 10.1.1 查看集群状态命令")]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl api"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("resources "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" more        # 查看集群中都有哪些资源（别买等）\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" cs                 # 查看master组件状态\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" node                # 查看node状态\n\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl cluster"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("info             # 查看Apiserver代理的"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("URL")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl describe "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("资源"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("名称"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       # 查看资源信息\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl describe node k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master       # 查看资源信息\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("h2",{attrs:{id:"_10-1-2-解决unhealthy状态"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-2-解决unhealthy状态"}},[s._v("#")]),s._v(" 10.1.2 解决Unhealthy状态")]),s._v(" "),r("ul",[r("li",[s._v("解决scheduler和controller-manager的Unhealthy状态")])]),s._v(" "),r("div",{staticClass:"language-javascript line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-javascript"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" cs                # 查看master组件状态\nWarning"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" v1 ComponentStatus is deprecated "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NAME")]),s._v("            "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("STATUS")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MESSAGE")]),s._v("       "),r("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ERROR")]),s._v("\nscheduler         Unhealthy   Get "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:10251/healthz"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" dial tcp "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10251")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" connect"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" connection refused   \ncontroller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager   Unhealthy   Get "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:10252/healthz"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" dial tcp "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10252")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" connect"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" connection refused   \netcd"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           Healthy    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n\n"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'将--port=0参数注释，然后重启kubelet  '")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manifests"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml    # 注释掉 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    #"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("manifests"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yaml \n    #"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("master "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# systemctl restart kubelet\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);